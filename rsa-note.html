<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-flash.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"hasegawaazusa.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.15.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="RSA 相关的笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="RSA 笔记">
<meta property="og:url" content="https://hasegawaazusa.github.io/rsa-note.html">
<meta property="og:site_name" content="独奏の小屋">
<meta property="og:description" content="RSA 相关的笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hasegawaazusa.github.io/rsa-note/RSA%E5%8F%82%E6%95%B0%E8%A7%A3%E7%A0%81%E7%BB%93%E6%9E%9C.png">
<meta property="og:image" content="https://hasegawaazusa.github.io/rsa-note/AMM%E4%BC%AA%E4%BB%A3%E7%A0%81.png">
<meta property="article:published_time" content="2022-02-11T13:30:00.000Z">
<meta property="article:modified_time" content="2024-03-20T12:35:15.805Z">
<meta property="article:author" content="qsdz">
<meta property="article:tag" content="crypto">
<meta property="article:tag" content="note">
<meta property="article:tag" content="rsa">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hasegawaazusa.github.io/rsa-note/RSA%E5%8F%82%E6%95%B0%E8%A7%A3%E7%A0%81%E7%BB%93%E6%9E%9C.png">


<link rel="canonical" href="https://hasegawaazusa.github.io/rsa-note.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://hasegawaazusa.github.io/rsa-note.html","path":"/rsa-note.html","title":"RSA 笔记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>RSA 笔记 | 独奏の小屋</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">独奏の小屋</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">67</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">133</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#rsa-%E7%AE%97%E6%B3%95%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">RSA 算法描述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rsa-%E5%BF%85%E8%A6%81%E7%AE%97%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">RSA 必要算法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%93%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95"><span class="nav-number">2.1.</span> <span class="nav-text">拓展欧几里得算法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B1%82%E9%80%86%E5%85%83"><span class="nav-number">2.2.</span> <span class="nav-text">求逆元</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%B9%82"><span class="nav-number">2.3.</span> <span class="nav-text">快速幂</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E8%AE%BA%E6%A8%A1%E8%BF%90%E7%AE%97"><span class="nav-number">2.4.</span> <span class="nav-text">数论模运算</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%99%A4%E6%B3%95"><span class="nav-number">2.4.1.</span> <span class="nav-text">除法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%9F%E6%95%B0%E6%AC%A1%E5%B9%82"><span class="nav-number">2.4.2.</span> <span class="nav-text">负数次幂</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0"><span class="nav-number">2.5.</span> <span class="nav-text">欧拉函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86"><span class="nav-number">2.6.</span> <span class="nav-text">中国剩余定理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A8%81%E5%B0%94%E9%80%8A%E5%AE%9A%E7%90%86"><span class="nav-number">2.7.</span> <span class="nav-text">威尔逊定理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B4%B9%E9%A9%AC%E5%B0%8F%E5%AE%9A%E7%90%86"><span class="nav-number">2.8.</span> <span class="nav-text">费马小定理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rsapython-%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.</span> <span class="nav-text">RSA&amp;python 实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E5%AF%86"><span class="nav-number">3.1.</span> <span class="nav-text">加密</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%AF%86"><span class="nav-number">3.2.</span> <span class="nav-text">解密</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.3.</span> <span class="nav-text">完整实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96%E5%8F%82%E6%95%B0"><span class="nav-number">3.4.</span> <span class="nav-text">读取参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E5%85%B7"><span class="nav-number">3.4.1.</span> <span class="nav-text">工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%8B%E8%AF%BB"><span class="nav-number">3.4.2.</span> <span class="nav-text">手读</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#poly-rsa"><span class="nav-number">3.5.</span> <span class="nav-text">Poly-RSA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E5%AF%86-1"><span class="nav-number">3.5.1.</span> <span class="nav-text">加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%AF%86-1"><span class="nav-number">3.5.2.</span> <span class="nav-text">解密</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rsa-%E6%94%BB%E5%87%BB"><span class="nav-number">4.</span> <span class="nav-text">RSA 攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E8%A7%A3%E6%A8%A1%E6%95%B0n"><span class="nav-number">4.1.</span> <span class="nav-text">分解模数N</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%82%BB%E8%BF%91%E5%9B%A0%E6%95%B0-pq-%E5%88%86%E8%A7%A3"><span class="nav-number">4.2.</span> <span class="nav-text">邻近因数 \((p,q)\) 分解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81"><span class="nav-number">4.2.1.</span> <span class="nav-text">特征</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC"><span class="nav-number">4.2.2.</span> <span class="nav-text">脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B1%E6%A8%A1%E6%95%B0%E6%94%BB%E5%87%BB"><span class="nav-number">4.3.</span> <span class="nav-text">共模数攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81-1"><span class="nav-number">4.3.1.</span> <span class="nav-text">特征</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">4.3.2.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.3.3.</span> <span class="nav-text">实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AC%E7%BA%A6%E6%95%B0%E6%94%BB%E5%87%BB"><span class="nav-number">4.4.</span> <span class="nav-text">公约数攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81-2"><span class="nav-number">4.4.1.</span> <span class="nav-text">特征</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-1"><span class="nav-number">4.4.2.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-1"><span class="nav-number">4.4.3.</span> <span class="nav-text">实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#n-%E4%B8%8E-varphin-%E5%88%86%E8%A7%A3"><span class="nav-number">4.5.</span> <span class="nav-text">\(N\) 与
\(\varphi(N)\) 分解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-2"><span class="nav-number">4.5.1.</span> <span class="nav-text">原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%8E%E5%8A%A0%E5%AF%86%E6%8C%87%E6%95%B0%E6%94%BB%E5%87%BB"><span class="nav-number">4.6.</span> <span class="nav-text">低加密指数攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81-3"><span class="nav-number">4.6.1.</span> <span class="nav-text">特征</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-3"><span class="nav-number">4.6.2.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-2"><span class="nav-number">4.6.3.</span> <span class="nav-text">实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#e1-%E6%94%BB%E5%87%BB"><span class="nav-number">4.7.</span> <span class="nav-text">\(e&#x3D;1\) 攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-3"><span class="nav-number">4.7.1.</span> <span class="nav-text">实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%8E%E5%8A%A0%E5%AF%86%E6%8C%87%E6%95%B0%E5%B9%BF%E6%92%AD%E6%94%BB%E5%87%BB"><span class="nav-number">4.8.</span> <span class="nav-text">低加密指数广播攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81-4"><span class="nav-number">4.8.1.</span> <span class="nav-text">特征</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-4"><span class="nav-number">4.8.2.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-4"><span class="nav-number">4.8.3.</span> <span class="nav-text">实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%B1%95"><span class="nav-number">4.8.4.</span> <span class="nav-text">扩展</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E7%9A%84%E6%89%A9%E5%B1%95"><span class="nav-number">4.8.5.</span> <span class="nav-text">扩展的扩展</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%8E%E8%A7%A3%E5%AF%86%E6%8C%87%E6%95%B0%E6%94%BB%E5%87%BB-wiener-attack"><span class="nav-number">4.9.</span> <span class="nav-text">低解密指数攻击 (Wiener
Attack)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81-5"><span class="nav-number">4.9.1.</span> <span class="nav-text">特征</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-5"><span class="nav-number">4.9.2.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-5"><span class="nav-number">4.9.3.</span> <span class="nav-text">实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dp-dq-%E6%B3%84%E9%9C%B2"><span class="nav-number">4.10.</span> <span class="nav-text">dp &amp; dq 泄露</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81-6"><span class="nav-number">4.10.1.</span> <span class="nav-text">特征</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-6"><span class="nav-number">4.10.2.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-6"><span class="nav-number">4.10.3.</span> <span class="nav-text">实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#d_p-%E6%B3%84%E9%9C%B2"><span class="nav-number">4.11.</span> <span class="nav-text">\(d_p\) 泄露</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-7"><span class="nav-number">4.11.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">4.11.2.</span> <span class="nav-text">代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%B1%95-1"><span class="nav-number">4.11.3.</span> <span class="nav-text">扩展</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E4%BB%A3%E7%A0%81"><span class="nav-number">4.11.4.</span> <span class="nav-text">扩展代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#d-%E6%B3%84%E9%9C%B2%E6%94%BB%E5%87%BB"><span class="nav-number">4.12.</span> <span class="nav-text">\(d\) 泄露攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-8"><span class="nav-number">4.12.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-1"><span class="nav-number">4.12.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%B2%E7%9F%A5-p-%E9%AB%98%E4%BD%8D"><span class="nav-number">4.13.</span> <span class="nav-text">已知 \(p\)
高位</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-9"><span class="nav-number">4.13.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B"><span class="nav-number">4.13.2.</span> <span class="nav-text">实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%B2%E7%9F%A5-p-%E4%BD%8E%E4%BD%8D"><span class="nav-number">4.14.</span> <span class="nav-text">已知 \(p\)
低位</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-10"><span class="nav-number">4.14.1.</span> <span class="nav-text">原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#e-%E4%B8%8E-varphin-%E4%B8%8D%E4%BA%92%E7%B4%A0"><span class="nav-number">4.15.</span> <span class="nav-text">\(e\) 与
\(\varphi(n)\) 不互素</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-11"><span class="nav-number">4.15.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-2"><span class="nav-number">4.15.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pq-%E9%AB%98%E4%BD%8D%E7%9B%B8%E5%90%8C"><span class="nav-number">4.16.</span> <span class="nav-text">\(p,q\)
高位相同</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81-7"><span class="nav-number">4.16.1.</span> <span class="nav-text">特征</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B-1"><span class="nav-number">4.16.2.</span> <span class="nav-text">实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E5%A1%AB%E5%85%85%E6%94%BB%E5%87%BB"><span class="nav-number">4.17.</span> <span class="nav-text">简单填充攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0"><span class="nav-number">4.17.1.</span> <span class="nav-text">题目描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-7"><span class="nav-number">4.17.2.</span> <span class="nav-text">实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-8"><span class="nav-number">4.17.3.</span> <span class="nav-text">实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rabin-%E6%94%BB%E5%87%BB"><span class="nav-number">4.18.</span> <span class="nav-text">Rabin 攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81-8"><span class="nav-number">4.18.1.</span> <span class="nav-text">特征</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-12"><span class="nav-number">4.18.2.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0-9"><span class="nav-number">4.18.3.</span> <span class="nav-text">实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E6%A0%B9%E6%B1%82%E8%A7%A3"><span class="nav-number">4.19.</span> <span class="nav-text">最小根求解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-13"><span class="nav-number">4.19.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-3"><span class="nav-number">4.19.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pq-%E5%AD%98%E5%9C%A8%E7%9B%B8%E5%90%8C-module-%E6%94%BB%E5%87%BB"><span class="nav-number">4.20.</span> <span class="nav-text">\(p,q\) 存在相同 module 攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81-9"><span class="nav-number">4.20.1.</span> <span class="nav-text">特征</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-4"><span class="nav-number">4.20.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%89%E9%99%90%E5%9F%9F%E5%BC%80%E6%A0%B9"><span class="nav-number">4.21.</span> <span class="nav-text">有限域开根</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81-10"><span class="nav-number">4.21.1.</span> <span class="nav-text">特征</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-14"><span class="nav-number">4.21.2.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-5"><span class="nav-number">4.21.3.</span> <span class="nav-text">代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#amm"><span class="nav-number">4.21.4.</span> <span class="nav-text">AMM</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p-1-%E5%85%89%E6%BB%91%E6%95%B0%E5%88%86%E8%A7%A3"><span class="nav-number">4.22.</span> <span class="nav-text">\(p-1\)
光滑数分解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81-11"><span class="nav-number">4.22.1.</span> <span class="nav-text">特征</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-15"><span class="nav-number">4.22.2.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B-2"><span class="nav-number">4.22.3.</span> <span class="nav-text">实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-6"><span class="nav-number">4.22.4.</span> <span class="nav-text">代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pollard-p-1-method"><span class="nav-number">4.22.5.</span> <span class="nav-text">Pollard p-1 method</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-16"><span class="nav-number">4.22.5.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-7"><span class="nav-number">4.22.5.2.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#p-%E8%BF%9B%E6%95%B0%E6%94%BB%E5%87%BB"><span class="nav-number">4.23.</span> <span class="nav-text">\(p\) 进数攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-17"><span class="nav-number">4.23.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B-3"><span class="nav-number">4.23.2.</span> <span class="nav-text">实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F%E5%85%B3%E8%81%94%E6%94%BB%E5%87%BB"><span class="nav-number">4.24.</span> <span class="nav-text">多项式关联攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-18"><span class="nav-number">4.24.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-8"><span class="nav-number">4.24.2.</span> <span class="nav-text">代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%B1%95-2"><span class="nav-number">4.24.3.</span> <span class="nav-text">扩展</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E5%A1%AB%E5%85%85%E5%A4%9A%E9%A1%B9%E5%BC%8F"><span class="nav-number">4.25.</span> <span class="nav-text">随机填充多项式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-19"><span class="nav-number">4.25.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-9"><span class="nav-number">4.25.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%B2%E7%9F%A5-poplus-q"><span class="nav-number">4.26.</span> <span class="nav-text">已知 \(p\oplus
q\)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-20"><span class="nav-number">4.26.1.</span> <span class="nav-text">原理</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="qsdz"
      src="/images/android-chrome-144x144.png">
  <p class="site-author-name" itemprop="name">qsdz</p>
  <div class="site-description" itemprop="description">又菜又爱玩，望轻喷</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">133</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">67</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/HasegawaAzusa" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;HasegawaAzusa" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hasegawaazusa.github.io/rsa-note.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/android-chrome-144x144.png">
      <meta itemprop="name" content="qsdz">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独奏の小屋">
      <meta itemprop="description" content="又菜又爱玩，望轻喷">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="RSA 笔记 | 独奏の小屋">
      <meta itemprop="description" content="RSA 相关的笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          RSA 笔记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-02-11 21:30:00" itemprop="dateCreated datePublished" datetime="2022-02-11T21:30:00+08:00">2022-02-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-20 20:35:15" itemprop="dateModified" datetime="2024-03-20T20:35:15+08:00">2024-03-20</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>69k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:03</span>
    </span>
</div>

            <div class="post-description">RSA 相关的笔记</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="rsa-算法描述">RSA 算法描述</h1>
<ol type="1">
<li><p>任意选取两个不同的大素数<span class="math inline">\(p\)</span>和<span class="math inline">\(q\)</span>计算乘积<span class="math inline">\(n=pq\)</span>，使用欧拉函数得到<span class="math inline">\(\varphi (n)=(p-1)(q-1)\)</span></p></li>
<li><p>任意选取一个大整数<span class="math inline">\(e\)</span>，满足<span class="math inline">\(gcd(e,
\varphi (n))=1\)</span>，整数<span class="math inline">\(e\)</span>用作加密密钥</p></li>
<li><p>确定的解密密钥<span class="math inline">\(d\)</span>，满足<span class="math inline">\((de)\ mod\ \varphi (n)=1\)</span>，即<span class="math inline">\(de=k\varphi (n)+1\)</span>，<span class="math inline">\(k\geq1\)</span>是一个任意的整数 (求逆元)</p></li>
<li><p>公开整数<span class="math inline">\(n\)</span>和<span class="math inline">\(e\)</span>，秘密保存<span class="math inline">\(d\)</span></p></li>
<li><p>将明文<span class="math inline">\(m\)</span>加密成密文<span class="math inline">\(c\)</span>，加密算法为： <span class="math display">\[
c=E(m)=m^e\ mod\ n
\]</span></p></li>
<li><p>将密文<span class="math inline">\(c\)</span>解密为明文<span class="math inline">\(m\)</span>，解密算法为： <span class="math display">\[
m=D(c)=c^d\ mod\ n
\]</span></p></li>
</ol>
<h1 id="rsa-必要算法">RSA 必要算法</h1>
<h2 id="拓展欧几里得算法">拓展欧几里得算法</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">extendedGCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="comment"># a*xi + b*yi = ri</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, a</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x, y, q = extendedGCD(b, a % b)</span><br><span class="line">        <span class="comment"># q = gcd(a, b) = gcd(b, a%b)</span></span><br><span class="line">        x, y = y, (x - (a // b) * y)</span><br><span class="line">        <span class="keyword">return</span> x, y, q</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以使用 <code>gmpy2.gcdext(a, b)</code> 替代，返回三元元组 <span class="math inline">\((g,s,t)\)</span></p>
<p>其中<span class="math inline">\(g=\gcd(a, b)=sa+tb\)</span></p>
</blockquote>
<p>存在相关性的定理：裴蜀定理。</p>
<p>裴蜀定理说明了对任意整数 <span class="math inline">\(a,b\)</span>
和它们的最大公约数 <span class="math inline">\(\gcd{(a,b)}=d\)</span>，那么对任意整数 <span class="math inline">\(x,y\)</span> 都有 <span class="math inline">\(ax+by\)</span> 为 <span class="math inline">\(d\)</span> 的倍数，即 <span class="math display">\[
ax+by=0\pmod{d}
\]</span> 特别地，一定存在整数使得 <span class="math inline">\(ax+by=d\)</span> 成立。</p>
<p>一个重要推论为，<span class="math inline">\(a,b\)</span>
互质的充分必要条件为存在整数 <span class="math inline">\(x,y\)</span>
使得 <span class="math inline">\(ax+by=1\)</span>。</p>
<blockquote>
<p>可以证明的是，求出的可行解必有 <span class="math inline">\(|s|\leq
b,|t|\leq a\)</span>。</p>
</blockquote>
<h2 id="求逆元">求逆元</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">invert</span>(<span class="params">e, phi</span>):</span><br><span class="line">    (x, y, r) = extendedGCD(e, phi)</span><br><span class="line">    <span class="comment"># y maybe &lt; 0, so convert it</span></span><br><span class="line">    <span class="keyword">if</span> y &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> phi + y</span><br><span class="line">    <span class="keyword">return</span> y</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以使用 <code>gmpy2.invert(e, phi)</code> 替代</p>
</blockquote>
<h2 id="快速幂">快速幂</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fastExpMod</span>(<span class="params">b,e,c</span>):</span><br><span class="line">    result = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> e != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> (e &amp; <span class="number">1</span>) == <span class="number">1</span>:</span><br><span class="line">            result = (result * b) % c</span><br><span class="line">        e &gt;&gt;= <span class="number">1</span></span><br><span class="line">        b = (b * b) % c</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以直接使用 python 自带的 <code>pow(b, e, c)</code></p>
</blockquote>
<h2 id="数论模运算">数论模运算</h2>
<h3 id="除法">除法</h3>
<p><span class="math display">\[
c=m\times a\ mod\ n\newline
\]</span></p>
<p>对于上式，已知<span class="math inline">\(c,a,n\)</span>求<span class="math inline">\(m\)</span>，不能直接求<span class="math inline">\(c\div a\)</span>，需要将其转换为 <span class="math display">\[
m=c\times invert(a,n)\ mod\ n
\]</span> 即<span class="math inline">\(c\)</span>乘以<span class="math inline">\(a\)</span>对<span class="math inline">\(n\)</span>的逆元</p>
<h3 id="负数次幂">负数次幂</h3>
<p>若要求 <span class="math display">\[
k=c^s\ mod\ n
\]</span> 其中<span class="math inline">\(s&lt;0\)</span>，则需要将其转换为 <span class="math display">\[
k=invert(c, n)^{-s}
\]</span> 即<span class="math inline">\(c\)</span>对<span class="math inline">\(n\)</span>的模反元素的<span class="math inline">\(-s\)</span>次幂</p>
<h2 id="欧拉函数">欧拉函数</h2>
<ul>
<li><p>如果<span class="math inline">\(p\)</span>是素数且<span class="math inline">\(k\geq 1\)</span>，则 <span class="math display">\[
\phi (p^k)=p^k-p^{k-1}
\]</span> 特别地，当<span class="math inline">\(k=1\)</span>时，表达式即为 <span class="math display">\[
\phi (p)=p-1
\]</span></p></li>
<li><p>如果<span class="math inline">\(gcd(m, n)=1\)</span>，即<span class="math inline">\(m,n\)</span>互质，则 <span class="math display">\[
\phi (mn)=\phi (m)\phi (n)
\]</span></p></li>
</ul>
<p>其中与之相关的有欧拉公式：</p>
<p>对任意两个互素整数 <span class="math inline">\(a,n\)</span>，有 <span class="math display">\[
a^{\varphi(n)}=1\pmod{n}
\]</span></p>
<h2 id="中国剩余定理">中国剩余定理</h2>
<p>设<span class="math inline">\(m\)</span>与<span class="math inline">\(n\)</span>是整数，<span class="math inline">\(gcd(m,n)=1\)</span>，<span class="math inline">\(b\)</span>与<span class="math inline">\(c\)</span>是任意整数，则同余式组 <span class="math display">\[
x\equiv b\ (mod\ m)\ 与\ x\equiv c\ (mod\ n)
\]</span> 恰有一个解 <span class="math inline">\(0\leq x\leq
mn\)</span></p>
<p>详细内容可以在<a href="/CRT-note.html">这里</a>了解</p>
<h2 id="威尔逊定理">威尔逊定理</h2>
<p>威尔逊定理给出了判定一个自然数是否为素数的充分必要条件：</p>
<p>当且仅当 <span class="math inline">\(p\)</span> 为素数时，有 <span class="math display">\[
(p-1)!\equiv-1\pmod{p}
\]</span> 或推论 <span class="math display">\[
(p-1)!+1=0\pmod{p}
\]</span> 即 <span class="math inline">\((p-1)!+1\)</span> 为 <span class="math inline">\(p\)</span> 的倍数。</p>
<p>一般用于辅助推导，相关的有伽马函数 <span class="math display">\[
\Gamma(n)=(n-1)!
\]</span></p>
<h2 id="费马小定理">费马小定理</h2>
<p>如果 <span class="math inline">\(p\)</span> 是一个素数，取任意的非
<span class="math inline">\(p\)</span> 整数 <span class="math inline">\(a\)</span>，有 <span class="math display">\[
a^{p-1}\equiv1\pmod{p}
\]</span> 推论有： <span class="math display">\[
\begin{align}
na^{p-1}&amp;\equiv n\pmod{p},n\in Z\\
a^{p-2}&amp;\equiv a^{-1}\pmod{p}\\
a^b&amp;\equiv a^{b\pmod{p-1}}\pmod{p},b\in Z\\
\end{align}
\]</span></p>
<h1 id="rsapython-实现">RSA&amp;python 实现</h1>
<h2 id="加密">加密</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p=<span class="number">447685307</span></span><br><span class="line">q=<span class="number">2037</span></span><br><span class="line">e=<span class="number">17</span></span><br><span class="line">m = <span class="number">904332399012</span></span><br><span class="line">n = p * q</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br></pre></td></tr></table></figure>
<h2 id="解密">解密</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p=<span class="number">447685307</span></span><br><span class="line">q=<span class="number">2037</span></span><br><span class="line">e=<span class="number">17</span></span><br><span class="line">c=<span class="number">704796792</span></span><br><span class="line">n = p * q</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, phi)</span><br><span class="line"><span class="comment"># 旧版本python需要使用gmpy2库求解逆元</span></span><br><span class="line"><span class="comment"># import gmpy2</span></span><br><span class="line"><span class="comment"># d = gmpy2.invert(e, phi)</span></span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br></pre></td></tr></table></figure>
<h2 id="完整实现">完整实现</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes, bytes_to_long</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen</span>(<span class="params">pbits: <span class="built_in">int</span>, ebits: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    生成公钥(n,e)和私钥(p,q,d)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数：</span></span><br><span class="line"><span class="string">        pbits - 素数p,q的位数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        ebits - 公钥e的位数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回值：</span></span><br><span class="line"><span class="string">        公钥(n,e), 私钥(p,q,d)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    p, q = getPrime(pbits), getPrime(pbits)</span><br><span class="line">    n = p * q</span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 如果e和phi公因数不为1，两个不同的素数一定是互质的，则无法找到唯一逆元</span></span><br><span class="line">    e = getPrime(ebits)</span><br><span class="line">    d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, phi)</span><br><span class="line">    <span class="keyword">return</span> (n, e), (p, q, d)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m: <span class="built_in">int</span>, pubkey: <span class="built_in">tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>]</span>):</span><br><span class="line">    n, e = pubkey</span><br><span class="line">    <span class="comment"># 切记不能是math.pow</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">c: <span class="built_in">int</span>, privkey: <span class="built_in">tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>, <span class="built_in">int</span>]</span>):</span><br><span class="line">    p, q, d = privkey</span><br><span class="line">    <span class="comment"># 切记不能是math.pow</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(c, d, p * q)</span><br><span class="line"></span><br><span class="line">pbits = <span class="number">1024</span></span><br><span class="line">ebits = <span class="number">32</span></span><br><span class="line"><span class="comment"># 获取公钥私钥</span></span><br><span class="line">pubkey, privkey = gen(pbits, ebits)</span><br><span class="line">msg = <span class="string">b&#x27;Aurora&#123;qsdzyyds!!!qsdzyyds!!!&#125;&#x27;</span></span><br><span class="line">m = bytes_to_long(msg)</span><br><span class="line"><span class="comment"># 加密</span></span><br><span class="line">c = encrypt(m, pubkey)</span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">mbar = decrypt(c, privkey)</span><br><span class="line">msgbar = long_to_bytes(mbar)</span><br><span class="line"><span class="built_in">print</span>(msgbar)</span><br></pre></td></tr></table></figure>
<h2 id="读取参数">读取参数</h2>
<h3 id="工具">工具</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./tmp/pubkey.pem&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    key = RSA.importKey(f)</span><br><span class="line">    N = key.n</span><br><span class="line">    e = key.e</span><br></pre></td></tr></table></figure>
<p>也可以使用在线网站：<a target="_blank" rel="noopener" href="http://www.hiencode.com/pub_asys.html">http://www.hiencode.com/pub_asys.html</a></p>
<p>或者使用 openssl 的 rsa 工具，例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -<span class="keyword">in</span> pub.key -text</span><br></pre></td></tr></table></figure>
<h3 id="手读">手读</h3>
<p>实际上 PEM 文件是遵循 ASN.1 格式的文件。</p>
<p>尝试生成一个密钥文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genpkey -algorithm rsa -out private_key.pem -pkeyopt rsa_keygen_bits:1024</span><br></pre></td></tr></table></figure>
<p>得到文件 <code>private_key.pem</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN PRIVATE KEY-----</span><br><span class="line">MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAOwGgqETvFHiR8Dg</span><br><span class="line">GBXtvWt/PxpyxUPcLCw06qaMctQ75ooqsSmEn95TlsHypN7ZxI9NUMRrRMo22ffl</span><br><span class="line">jZrPBfseJ81igemIYbThQg90miIU/FYd2G952zk4CX/clSszWeONDwSYDm6RfzOJ</span><br><span class="line">TnwUXyC41yoOoeIpo0v20kxKlAFVAgMBAAECgYEA2iFKKMOsj6Co38A7gkitfuOi</span><br><span class="line">1jaryQN6b4CYPEQg+7RAZAEAqnY/qaFm+ufdJ3frCOVTd7QLZzc6SriEHkamJqBf</span><br><span class="line">1ylfevyjHL9FhSprkqMMUF2qrGG6ZEzxMQ1rltymN4xpR0zagyvbKpBOIK5reyIk</span><br><span class="line">4aCsu/mu4+etOctq1CECQQD4T1lmKxp8tQoRKrzbHT0GYEO+zBCBDNe68i8qT9Ox</span><br><span class="line">4dXYWwrzLtA0R8XSmKlyr+kbT7ukOxnN29JgtRR6SFVPAkEA81XEUiEG/TXgIFIA</span><br><span class="line">8NuviVsrc8v7X5HdC4XkmfCFJxCROm5N4XWL4AwE4MVfaSGRKa9QovGzmpeSYKaP</span><br><span class="line">qGBeGwJBAIA62fv8/mywQUakP2sYKk+EnveFAnDiZPXR47GCD9yot3pHadwzrKmS</span><br><span class="line">9wHOfJMRbNwBzPD+5FB+2KHAYZbUi9kCQEBi2FCW9p93aveCW0dgCcGBgyzfs4Ll</span><br><span class="line">OKT857En6EOe6Z6ZYzgd/0XoSD4lW4qY3C04e1CyPcDRDGVQjUCTRzMCQGfuop7q</span><br><span class="line">2zfXztkIfLOxXkiYogjxJGTRRTCF48gyF/WKLhUbR76Gzd6VfDtaoDdpz3hGfy82</span><br><span class="line">VEu5qg9fzchFlEw=</span><br><span class="line">-----END PRIVATE KEY-----</span><br></pre></td></tr></table></figure>
<p>对于参数每 48 个字节用一行 64 字符的 base64
表示，直接解码可以得到十六进制下参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">30820277020100300d06092a864886f70d0101010500048202613082025d02010002818100ec0682a113bc51e247c0e01815edbd6b7f3f1a72c543dc2c2c34eaa68c72d43be68a2ab129849fde5396c1f2a4ded9c48f4d50c46b44ca36d9f7e58d9acf05fb1e27cd6281e98861b4e1420f749a2214fc561dd86f79db3938097fdc952b3359e38d0f04980e6e917f33894e7c145f20b8d72a0ea1e229a34bf6d24c4a940155020301000102818100da214a28c3ac8fa0a8dfc03b8248ad7ee3a2d636abc9037a6f80983c4420fbb440640100aa763fa9a166fae7dd2777eb08e55377b40b67373a4ab8841e46a626a05fd7295f7afca31cbf45852a6b92a30c505daaac61ba644cf1310d6b96dca6378c69474cda832bdb2a904e20ae6b7b2224e1a0acbbf9aee3e7ad39cb6ad421024100f84f59662b1a7cb50a112abcdb1d3d066043becc10810cd7baf22f2a4fd3b1e1d5d85b0af32ed03447c5d298a972afe91b4fbba43b19cddbd260b5147a48554f024100f355c4522106fd35e0205200f0dbaf895b2b73cbfb5f91dd0b85e499f0852710913a6e4de1758be00c04e0c55f69219129af50a2f1b39a979260a68fa8605e1b024100803ad9fbfcfe6cb04146a43f6b182a4f849ef7850270e264f5d1e3b1820fdca8b77a4769dc33aca992f701ce7c93116cdc01ccf0fee4507ed8a1c06196d48bd902404062d85096f69f776af7825b476009c181832cdfb382e538a4fce7b127e8439ee99e9963381dff45e8483e255b8a98dc2d387b50b23dc0d10c65508d40934733024067eea29eeadb37d7ced9087cb3b15e4898a208f12464d1453085e3c83217f58a2e151b47be86cdde957c3b5aa03769cf78467f2f36544bb9aa0f5fcdc845944c</span><br></pre></td></tr></table></figure>
<p>使用在线 ASN.1 解码网站：<a target="_blank" rel="noopener" href="https://lapo.it/asn1js">https://lapo.it/asn1js</a></p>
<figure>
<img src="/rsa-note/RSA参数解码结果.png" alt="RSA参数解码结果">
<figcaption aria-hidden="true">RSA参数解码结果</figcaption>
</figure>
<p>如果是损坏的或者是人为混淆过的
PEM，可以用上面这段标准字节流一一对照分析。</p>
<h2 id="poly-rsa">Poly-RSA</h2>
<h3 id="加密-1">加密</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="built_in">list</span>(<span class="string">b&#x27;watevr&#123;RSA_from_ikea_is_fun_but_insecure#k20944uehdjfnjd335uro&#125;&#x27;</span>)</span><br><span class="line">p = <span class="number">43753</span></span><br><span class="line"><span class="comment">## Univariate Polynomial Ring in y over Finite Field of size p</span></span><br><span class="line">R.&lt;y&gt; = GF(p)[]</span><br><span class="line"></span><br><span class="line"><span class="comment">## Analogous to the primes in Z</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_irreducable_poly</span>(<span class="params">deg</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        out = R.random_element(degree=deg)</span><br><span class="line">        <span class="keyword">if</span> out.is_irreducible():</span><br><span class="line">            <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## Polynomial &quot;primes&quot;</span></span><br><span class="line">P = gen_irreducable_poly(ZZ.random_element(length, <span class="number">2</span>*length))</span><br><span class="line">Q = gen_irreducable_poly(ZZ.random_element(length, <span class="number">2</span>*length))</span><br><span class="line"></span><br><span class="line"><span class="comment">## Public exponent key</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Modulus</span></span><br><span class="line">N = P*Q</span><br><span class="line"></span><br><span class="line"><span class="comment">## Univariate Quotient Polynomial Ring in x over Finite Field of size 659 with modulus N(x)</span></span><br><span class="line">S.&lt;x&gt; = R.quotient(N)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Encrypt</span></span><br><span class="line">m = S(flag)</span><br><span class="line">c = m^e</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">P=y^<span class="number">65</span> + <span class="number">39688</span>*y^<span class="number">64</span> + <span class="number">22199</span>*y^<span class="number">63</span> + <span class="number">41942</span>*y^<span class="number">62</span> + <span class="number">7803</span>*y^<span class="number">61</span> + <span class="number">19710</span>*y^<span class="number">60</span> + <span class="number">14794</span>*y^<span class="number">59</span> + <span class="number">41388</span>*y^<span class="number">58</span> + <span class="number">2418</span>*y^<span class="number">57</span> + <span class="number">19208</span>*y^<span class="number">56</span> + <span class="number">39941</span>*y^<span class="number">55</span> + <span class="number">36392</span>*y^<span class="number">54</span> + <span class="number">19813</span>*y^<span class="number">53</span> + <span class="number">33864</span>*y^<span class="number">52</span> + <span class="number">29099</span>*y^<span class="number">51</span> + <span class="number">15484</span>*y^<span class="number">50</span> + <span class="number">27185</span>*y^<span class="number">49</span> + <span class="number">27721</span>*y^<span class="number">48</span> + <span class="number">31508</span>*y^<span class="number">47</span> + <span class="number">19404</span>*y^<span class="number">46</span> + <span class="number">10134</span>*y^<span class="number">45</span> + <span class="number">43481</span>*y^<span class="number">44</span> + <span class="number">3899</span>*y^<span class="number">43</span> + <span class="number">32849</span>*y^<span class="number">42</span> + <span class="number">3534</span>*y^<span class="number">41</span> + <span class="number">32086</span>*y^<span class="number">40</span> + <span class="number">14221</span>*y^<span class="number">39</span> + <span class="number">42982</span>*y^<span class="number">38</span> + <span class="number">1403</span>*y^<span class="number">37</span> + <span class="number">1619</span>*y^<span class="number">36</span> + <span class="number">36054</span>*y^<span class="number">35</span> + <span class="number">33615</span>*y^<span class="number">34</span> + <span class="number">6628</span>*y^<span class="number">33</span> + <span class="number">31709</span>*y^<span class="number">32</span> + <span class="number">6968</span>*y^<span class="number">31</span> + <span class="number">28517</span>*y^<span class="number">30</span> + <span class="number">12938</span>*y^<span class="number">29</span> + <span class="number">21124</span>*y^<span class="number">28</span> + <span class="number">10400</span>*y^<span class="number">27</span> + <span class="number">28889</span>*y^<span class="number">26</span> + <span class="number">7273</span>*y^<span class="number">25</span> + <span class="number">36442</span>*y^<span class="number">24</span> + <span class="number">14935</span>*y^<span class="number">23</span> + <span class="number">29365</span>*y^<span class="number">22</span> + <span class="number">4869</span>*y^<span class="number">21</span> + <span class="number">43562</span>*y^<span class="number">20</span> + <span class="number">6435</span>*y^<span class="number">19</span> + <span class="number">4403</span>*y^<span class="number">18</span> + <span class="number">32311</span>*y^<span class="number">17</span> + <span class="number">7575</span>*y^<span class="number">16</span> + <span class="number">28199</span>*y^<span class="number">15</span> + <span class="number">28065</span>*y^<span class="number">14</span> + <span class="number">23870</span>*y^<span class="number">13</span> + <span class="number">37314</span>*y^<span class="number">12</span> + <span class="number">15299</span>*y^<span class="number">11</span> + <span class="number">7082</span>*y^<span class="number">10</span> + <span class="number">36230</span>*y^<span class="number">9</span> + <span class="number">18367</span>*y^<span class="number">8</span> + <span class="number">12531</span>*y^<span class="number">7</span> + <span class="number">25906</span>*y^<span class="number">6</span> + <span class="number">26878</span>*y^<span class="number">5</span> + <span class="number">43073</span>*y^<span class="number">4</span> + <span class="number">11582</span>*y^<span class="number">3</span> + <span class="number">4482</span>*y^<span class="number">2</span> + <span class="number">35044</span>*y + <span class="number">31388</span></span><br><span class="line">Q=y^<span class="number">112</span> + <span class="number">31097</span>*y^<span class="number">111</span> + <span class="number">15815</span>*y^<span class="number">110</span> + <span class="number">17170</span>*y^<span class="number">109</span> + <span class="number">43684</span>*y^<span class="number">108</span> + <span class="number">16873</span>*y^<span class="number">107</span> + <span class="number">17269</span>*y^<span class="number">106</span> + <span class="number">10853</span>*y^<span class="number">105</span> + <span class="number">10690</span>*y^<span class="number">104</span> + <span class="number">24864</span>*y^<span class="number">103</span> + <span class="number">10224</span>*y^<span class="number">102</span> + <span class="number">28704</span>*y^<span class="number">101</span> + <span class="number">16049</span>*y^<span class="number">100</span> + <span class="number">1154</span>*y^<span class="number">99</span> + <span class="number">40034</span>*y^<span class="number">98</span> + <span class="number">29922</span>*y^<span class="number">97</span> + <span class="number">27404</span>*y^<span class="number">96</span> + <span class="number">32514</span>*y^<span class="number">95</span> + <span class="number">40962</span>*y^<span class="number">94</span> + <span class="number">32858</span>*y^<span class="number">93</span> + <span class="number">36590</span>*y^<span class="number">92</span> + <span class="number">41302</span>*y^<span class="number">91</span> + <span class="number">20803</span>*y^<span class="number">90</span> + <span class="number">43521</span>*y^<span class="number">89</span> + <span class="number">13746</span>*y^<span class="number">88</span> + <span class="number">19857</span>*y^<span class="number">87</span> + <span class="number">21539</span>*y^<span class="number">86</span> + <span class="number">36888</span>*y^<span class="number">85</span> + <span class="number">16032</span>*y^<span class="number">84</span> + <span class="number">35825</span>*y^<span class="number">83</span> + <span class="number">24705</span>*y^<span class="number">82</span> + <span class="number">31143</span>*y^<span class="number">81</span> + <span class="number">22088</span>*y^<span class="number">80</span> + <span class="number">6686</span>*y^<span class="number">79</span> + <span class="number">37947</span>*y^<span class="number">78</span> + <span class="number">5661</span>*y^<span class="number">77</span> + <span class="number">29405</span>*y^<span class="number">76</span> + <span class="number">36071</span>*y^<span class="number">75</span> + <span class="number">35492</span>*y^<span class="number">74</span> + <span class="number">28985</span>*y^<span class="number">73</span> + <span class="number">36015</span>*y^<span class="number">72</span> + <span class="number">24095</span>*y^<span class="number">71</span> + <span class="number">34920</span>*y^<span class="number">70</span> + <span class="number">6615</span>*y^<span class="number">69</span> + <span class="number">9606</span>*y^<span class="number">68</span> + <span class="number">4255</span>*y^<span class="number">67</span> + <span class="number">22981</span>*y^<span class="number">66</span> + <span class="number">3910</span>*y^<span class="number">65</span> + <span class="number">23897</span>*y^<span class="number">64</span> + <span class="number">22711</span>*y^<span class="number">63</span> + <span class="number">23350</span>*y^<span class="number">62</span> + <span class="number">7969</span>*y^<span class="number">61</span> + <span class="number">8558</span>*y^<span class="number">60</span> + <span class="number">8001</span>*y^<span class="number">59</span> + <span class="number">8431</span>*y^<span class="number">58</span> + <span class="number">3314</span>*y^<span class="number">57</span> + <span class="number">23364</span>*y^<span class="number">56</span> + <span class="number">39391</span>*y^<span class="number">55</span> + <span class="number">32722</span>*y^<span class="number">54</span> + <span class="number">2543</span>*y^<span class="number">53</span> + <span class="number">22196</span>*y^<span class="number">52</span> + <span class="number">24189</span>*y^<span class="number">51</span> + <span class="number">19420</span>*y^<span class="number">50</span> + <span class="number">10649</span>*y^<span class="number">49</span> + <span class="number">19070</span>*y^<span class="number">48</span> + <span class="number">23863</span>*y^<span class="number">47</span> + <span class="number">19597</span>*y^<span class="number">46</span> + <span class="number">39699</span>*y^<span class="number">45</span> + <span class="number">7620</span>*y^<span class="number">44</span> + <span class="number">25067</span>*y^<span class="number">43</span> + <span class="number">29912</span>*y^<span class="number">42</span> + <span class="number">14998</span>*y^<span class="number">41</span> + <span class="number">14492</span>*y^<span class="number">40</span> + <span class="number">31322</span>*y^<span class="number">39</span> + <span class="number">43145</span>*y^<span class="number">38</span> + <span class="number">32006</span>*y^<span class="number">37</span> + <span class="number">38976</span>*y^<span class="number">36</span> + <span class="number">32534</span>*y^<span class="number">35</span> + <span class="number">6972</span>*y^<span class="number">34</span> + <span class="number">37351</span>*y^<span class="number">33</span> + <span class="number">30104</span>*y^<span class="number">32</span> + <span class="number">6032</span>*y^<span class="number">31</span> + <span class="number">33729</span>*y^<span class="number">30</span> + <span class="number">27110</span>*y^<span class="number">29</span> + <span class="number">5268</span>*y^<span class="number">28</span> + <span class="number">2974</span>*y^<span class="number">27</span> + <span class="number">2985</span>*y^<span class="number">26</span> + <span class="number">31610</span>*y^<span class="number">25</span> + <span class="number">28364</span>*y^<span class="number">24</span> + <span class="number">34924</span>*y^<span class="number">23</span> + <span class="number">17414</span>*y^<span class="number">22</span> + <span class="number">28813</span>*y^<span class="number">21</span> + <span class="number">43680</span>*y^<span class="number">20</span> + <span class="number">32175</span>*y^<span class="number">19</span> + <span class="number">18248</span>*y^<span class="number">18</span> + <span class="number">25171</span>*y^<span class="number">17</span> + <span class="number">31185</span>*y^<span class="number">16</span> + <span class="number">30125</span>*y^<span class="number">15</span> + <span class="number">36836</span>*y^<span class="number">14</span> + <span class="number">7218</span>*y^<span class="number">13</span> + <span class="number">11292</span>*y^<span class="number">12</span> + <span class="number">31123</span>*y^<span class="number">11</span> + <span class="number">40360</span>*y^<span class="number">10</span> + <span class="number">34093</span>*y^<span class="number">9</span> + <span class="number">39606</span>*y^<span class="number">8</span> + <span class="number">2788</span>*y^<span class="number">7</span> + <span class="number">27277</span>*y^<span class="number">6</span> + <span class="number">21835</span>*y^<span class="number">5</span> + <span class="number">1331</span>*y^<span class="number">4</span> + <span class="number">32614</span>*y^<span class="number">3</span> + <span class="number">25020</span>*y^<span class="number">2</span> + <span class="number">20981</span>*y + <span class="number">12108</span></span><br><span class="line">N=<span class="number">34036</span>*y^<span class="number">177</span> + <span class="number">23068</span>*y^<span class="number">176</span> + <span class="number">13147</span>*y^<span class="number">175</span> + <span class="number">36344</span>*y^<span class="number">174</span> + <span class="number">10045</span>*y^<span class="number">173</span> + <span class="number">41049</span>*y^<span class="number">172</span> + <span class="number">17786</span>*y^<span class="number">171</span> + <span class="number">16601</span>*y^<span class="number">170</span> + <span class="number">7929</span>*y^<span class="number">169</span> + <span class="number">37570</span>*y^<span class="number">168</span> + <span class="number">990</span>*y^<span class="number">167</span> + <span class="number">9622</span>*y^<span class="number">166</span> + <span class="number">39273</span>*y^<span class="number">165</span> + <span class="number">35284</span>*y^<span class="number">164</span> + <span class="number">15632</span>*y^<span class="number">163</span> + <span class="number">18850</span>*y^<span class="number">162</span> + <span class="number">8800</span>*y^<span class="number">161</span> + <span class="number">33148</span>*y^<span class="number">160</span> + <span class="number">12147</span>*y^<span class="number">159</span> + <span class="number">40487</span>*y^<span class="number">158</span> + <span class="number">6407</span>*y^<span class="number">157</span> + <span class="number">34111</span>*y^<span class="number">156</span> + <span class="number">8446</span>*y^<span class="number">155</span> + <span class="number">21908</span>*y^<span class="number">154</span> + <span class="number">16812</span>*y^<span class="number">153</span> + <span class="number">40624</span>*y^<span class="number">152</span> + <span class="number">43506</span>*y^<span class="number">151</span> + <span class="number">39116</span>*y^<span class="number">150</span> + <span class="number">33011</span>*y^<span class="number">149</span> + <span class="number">23914</span>*y^<span class="number">148</span> + <span class="number">2210</span>*y^<span class="number">147</span> + <span class="number">23196</span>*y^<span class="number">146</span> + <span class="number">43359</span>*y^<span class="number">145</span> + <span class="number">34455</span>*y^<span class="number">144</span> + <span class="number">17684</span>*y^<span class="number">143</span> + <span class="number">25262</span>*y^<span class="number">142</span> + <span class="number">982</span>*y^<span class="number">141</span> + <span class="number">24015</span>*y^<span class="number">140</span> + <span class="number">27968</span>*y^<span class="number">139</span> + <span class="number">37463</span>*y^<span class="number">138</span> + <span class="number">10667</span>*y^<span class="number">137</span> + <span class="number">39519</span>*y^<span class="number">136</span> + <span class="number">31176</span>*y^<span class="number">135</span> + <span class="number">27520</span>*y^<span class="number">134</span> + <span class="number">32118</span>*y^<span class="number">133</span> + <span class="number">8333</span>*y^<span class="number">132</span> + <span class="number">38945</span>*y^<span class="number">131</span> + <span class="number">34713</span>*y^<span class="number">130</span> + <span class="number">1107</span>*y^<span class="number">129</span> + <span class="number">43604</span>*y^<span class="number">128</span> + <span class="number">4433</span>*y^<span class="number">127</span> + <span class="number">18110</span>*y^<span class="number">126</span> + <span class="number">17658</span>*y^<span class="number">125</span> + <span class="number">32354</span>*y^<span class="number">124</span> + <span class="number">3219</span>*y^<span class="number">123</span> + <span class="number">40238</span>*y^<span class="number">122</span> + <span class="number">10439</span>*y^<span class="number">121</span> + <span class="number">3669</span>*y^<span class="number">120</span> + <span class="number">8713</span>*y^<span class="number">119</span> + <span class="number">21027</span>*y^<span class="number">118</span> + <span class="number">29480</span>*y^<span class="number">117</span> + <span class="number">5477</span>*y^<span class="number">116</span> + <span class="number">24332</span>*y^<span class="number">115</span> + <span class="number">43480</span>*y^<span class="number">114</span> + <span class="number">33406</span>*y^<span class="number">113</span> + <span class="number">43121</span>*y^<span class="number">112</span> + <span class="number">1114</span>*y^<span class="number">111</span> + <span class="number">17198</span>*y^<span class="number">110</span> + <span class="number">22829</span>*y^<span class="number">109</span> + <span class="number">24424</span>*y^<span class="number">108</span> + <span class="number">16523</span>*y^<span class="number">107</span> + <span class="number">20424</span>*y^<span class="number">106</span> + <span class="number">36206</span>*y^<span class="number">105</span> + <span class="number">41849</span>*y^<span class="number">104</span> + <span class="number">3584</span>*y^<span class="number">103</span> + <span class="number">26500</span>*y^<span class="number">102</span> + <span class="number">31897</span>*y^<span class="number">101</span> + <span class="number">34640</span>*y^<span class="number">100</span> + <span class="number">27449</span>*y^<span class="number">99</span> + <span class="number">30962</span>*y^<span class="number">98</span> + <span class="number">41434</span>*y^<span class="number">97</span> + <span class="number">22125</span>*y^<span class="number">96</span> + <span class="number">24314</span>*y^<span class="number">95</span> + <span class="number">3944</span>*y^<span class="number">94</span> + <span class="number">18400</span>*y^<span class="number">93</span> + <span class="number">38476</span>*y^<span class="number">92</span> + <span class="number">28904</span>*y^<span class="number">91</span> + <span class="number">27936</span>*y^<span class="number">90</span> + <span class="number">41867</span>*y^<span class="number">89</span> + <span class="number">25573</span>*y^<span class="number">88</span> + <span class="number">25659</span>*y^<span class="number">87</span> + <span class="number">33443</span>*y^<span class="number">86</span> + <span class="number">18435</span>*y^<span class="number">85</span> + <span class="number">5934</span>*y^<span class="number">84</span> + <span class="number">38030</span>*y^<span class="number">83</span> + <span class="number">17563</span>*y^<span class="number">82</span> + <span class="number">24086</span>*y^<span class="number">81</span> + <span class="number">36782</span>*y^<span class="number">80</span> + <span class="number">20922</span>*y^<span class="number">79</span> + <span class="number">38933</span>*y^<span class="number">78</span> + <span class="number">23448</span>*y^<span class="number">77</span> + <span class="number">10599</span>*y^<span class="number">76</span> + <span class="number">7156</span>*y^<span class="number">75</span> + <span class="number">29044</span>*y^<span class="number">74</span> + <span class="number">23605</span>*y^<span class="number">73</span> + <span class="number">7657</span>*y^<span class="number">72</span> + <span class="number">28200</span>*y^<span class="number">71</span> + <span class="number">2431</span>*y^<span class="number">70</span> + <span class="number">3860</span>*y^<span class="number">69</span> + <span class="number">23259</span>*y^<span class="number">68</span> + <span class="number">14590</span>*y^<span class="number">67</span> + <span class="number">33631</span>*y^<span class="number">66</span> + <span class="number">15673</span>*y^<span class="number">65</span> + <span class="number">36049</span>*y^<span class="number">64</span> + <span class="number">29728</span>*y^<span class="number">63</span> + <span class="number">22413</span>*y^<span class="number">62</span> + <span class="number">18602</span>*y^<span class="number">61</span> + <span class="number">18557</span>*y^<span class="number">60</span> + <span class="number">23505</span>*y^<span class="number">59</span> + <span class="number">17642</span>*y^<span class="number">58</span> + <span class="number">12595</span>*y^<span class="number">57</span> + <span class="number">17255</span>*y^<span class="number">56</span> + <span class="number">15316</span>*y^<span class="number">55</span> + <span class="number">8948</span>*y^<span class="number">54</span> + <span class="number">38</span>*y^<span class="number">53</span> + <span class="number">40329</span>*y^<span class="number">52</span> + <span class="number">9823</span>*y^<span class="number">51</span> + <span class="number">5798</span>*y^<span class="number">50</span> + <span class="number">6379</span>*y^<span class="number">49</span> + <span class="number">8662</span>*y^<span class="number">48</span> + <span class="number">34640</span>*y^<span class="number">47</span> + <span class="number">38321</span>*y^<span class="number">46</span> + <span class="number">18760</span>*y^<span class="number">45</span> + <span class="number">13135</span>*y^<span class="number">44</span> + <span class="number">15926</span>*y^<span class="number">43</span> + <span class="number">34952</span>*y^<span class="number">42</span> + <span class="number">28940</span>*y^<span class="number">41</span> + <span class="number">13558</span>*y^<span class="number">40</span> + <span class="number">42579</span>*y^<span class="number">39</span> + <span class="number">38015</span>*y^<span class="number">38</span> + <span class="number">33788</span>*y^<span class="number">37</span> + <span class="number">12381</span>*y^<span class="number">36</span> + <span class="number">195</span>*y^<span class="number">35</span> + <span class="number">13709</span>*y^<span class="number">34</span> + <span class="number">31500</span>*y^<span class="number">33</span> + <span class="number">32994</span>*y^<span class="number">32</span> + <span class="number">30486</span>*y^<span class="number">31</span> + <span class="number">40414</span>*y^<span class="number">30</span> + <span class="number">2578</span>*y^<span class="number">29</span> + <span class="number">30525</span>*y^<span class="number">28</span> + <span class="number">43067</span>*y^<span class="number">27</span> + <span class="number">6195</span>*y^<span class="number">26</span> + <span class="number">36288</span>*y^<span class="number">25</span> + <span class="number">23236</span>*y^<span class="number">24</span> + <span class="number">21493</span>*y^<span class="number">23</span> + <span class="number">15808</span>*y^<span class="number">22</span> + <span class="number">34500</span>*y^<span class="number">21</span> + <span class="number">6390</span>*y^<span class="number">20</span> + <span class="number">42994</span>*y^<span class="number">19</span> + <span class="number">42151</span>*y^<span class="number">18</span> + <span class="number">19248</span>*y^<span class="number">17</span> + <span class="number">19291</span>*y^<span class="number">16</span> + <span class="number">8124</span>*y^<span class="number">15</span> + <span class="number">40161</span>*y^<span class="number">14</span> + <span class="number">24726</span>*y^<span class="number">13</span> + <span class="number">31874</span>*y^<span class="number">12</span> + <span class="number">30272</span>*y^<span class="number">11</span> + <span class="number">30761</span>*y^<span class="number">10</span> + <span class="number">2296</span>*y^<span class="number">9</span> + <span class="number">11017</span>*y^<span class="number">8</span> + <span class="number">16559</span>*y^<span class="number">7</span> + <span class="number">28949</span>*y^<span class="number">6</span> + <span class="number">40499</span>*y^<span class="number">5</span> + <span class="number">22377</span>*y^<span class="number">4</span> + <span class="number">33628</span>*y^<span class="number">3</span> + <span class="number">30598</span>*y^<span class="number">2</span> + <span class="number">4386</span>*y + <span class="number">23814</span></span><br><span class="line">c=<span class="number">5209</span>*x^<span class="number">176</span> + <span class="number">10881</span>*x^<span class="number">175</span> + <span class="number">31096</span>*x^<span class="number">174</span> + <span class="number">23354</span>*x^<span class="number">173</span> + <span class="number">28337</span>*x^<span class="number">172</span> + <span class="number">15982</span>*x^<span class="number">171</span> + <span class="number">13515</span>*x^<span class="number">170</span> + <span class="number">21641</span>*x^<span class="number">169</span> + <span class="number">10254</span>*x^<span class="number">168</span> + <span class="number">34588</span>*x^<span class="number">167</span> + <span class="number">27434</span>*x^<span class="number">166</span> + <span class="number">29552</span>*x^<span class="number">165</span> + <span class="number">7105</span>*x^<span class="number">164</span> + <span class="number">22604</span>*x^<span class="number">163</span> + <span class="number">41253</span>*x^<span class="number">162</span> + <span class="number">42675</span>*x^<span class="number">161</span> + <span class="number">21153</span>*x^<span class="number">160</span> + <span class="number">32838</span>*x^<span class="number">159</span> + <span class="number">34391</span>*x^<span class="number">158</span> + <span class="number">832</span>*x^<span class="number">157</span> + <span class="number">720</span>*x^<span class="number">156</span> + <span class="number">22883</span>*x^<span class="number">155</span> + <span class="number">19236</span>*x^<span class="number">154</span> + <span class="number">33772</span>*x^<span class="number">153</span> + <span class="number">5020</span>*x^<span class="number">152</span> + <span class="number">17943</span>*x^<span class="number">151</span> + <span class="number">26967</span>*x^<span class="number">150</span> + <span class="number">30847</span>*x^<span class="number">149</span> + <span class="number">10306</span>*x^<span class="number">148</span> + <span class="number">33966</span>*x^<span class="number">147</span> + <span class="number">43255</span>*x^<span class="number">146</span> + <span class="number">20342</span>*x^<span class="number">145</span> + <span class="number">4474</span>*x^<span class="number">144</span> + <span class="number">3490</span>*x^<span class="number">143</span> + <span class="number">38033</span>*x^<span class="number">142</span> + <span class="number">11224</span>*x^<span class="number">141</span> + <span class="number">30565</span>*x^<span class="number">140</span> + <span class="number">31967</span>*x^<span class="number">139</span> + <span class="number">32382</span>*x^<span class="number">138</span> + <span class="number">9759</span>*x^<span class="number">137</span> + <span class="number">1030</span>*x^<span class="number">136</span> + <span class="number">32122</span>*x^<span class="number">135</span> + <span class="number">42614</span>*x^<span class="number">134</span> + <span class="number">14280</span>*x^<span class="number">133</span> + <span class="number">16533</span>*x^<span class="number">132</span> + <span class="number">32676</span>*x^<span class="number">131</span> + <span class="number">43070</span>*x^<span class="number">130</span> + <span class="number">36009</span>*x^<span class="number">129</span> + <span class="number">28497</span>*x^<span class="number">128</span> + <span class="number">2940</span>*x^<span class="number">127</span> + <span class="number">9747</span>*x^<span class="number">126</span> + <span class="number">22758</span>*x^<span class="number">125</span> + <span class="number">16615</span>*x^<span class="number">124</span> + <span class="number">14086</span>*x^<span class="number">123</span> + <span class="number">13038</span>*x^<span class="number">122</span> + <span class="number">39603</span>*x^<span class="number">121</span> + <span class="number">36260</span>*x^<span class="number">120</span> + <span class="number">32502</span>*x^<span class="number">119</span> + <span class="number">17619</span>*x^<span class="number">118</span> + <span class="number">17700</span>*x^<span class="number">117</span> + <span class="number">15083</span>*x^<span class="number">116</span> + <span class="number">11311</span>*x^<span class="number">115</span> + <span class="number">36496</span>*x^<span class="number">114</span> + <span class="number">1300</span>*x^<span class="number">113</span> + <span class="number">13601</span>*x^<span class="number">112</span> + <span class="number">43425</span>*x^<span class="number">111</span> + <span class="number">10376</span>*x^<span class="number">110</span> + <span class="number">11551</span>*x^<span class="number">109</span> + <span class="number">13684</span>*x^<span class="number">108</span> + <span class="number">14955</span>*x^<span class="number">107</span> + <span class="number">6661</span>*x^<span class="number">106</span> + <span class="number">12674</span>*x^<span class="number">105</span> + <span class="number">21534</span>*x^<span class="number">104</span> + <span class="number">32132</span>*x^<span class="number">103</span> + <span class="number">34135</span>*x^<span class="number">102</span> + <span class="number">43684</span>*x^<span class="number">101</span> + <span class="number">837</span>*x^<span class="number">100</span> + <span class="number">29311</span>*x^<span class="number">99</span> + <span class="number">4849</span>*x^<span class="number">98</span> + <span class="number">26632</span>*x^<span class="number">97</span> + <span class="number">26662</span>*x^<span class="number">96</span> + <span class="number">10159</span>*x^<span class="number">95</span> + <span class="number">32657</span>*x^<span class="number">94</span> + <span class="number">12149</span>*x^<span class="number">93</span> + <span class="number">17858</span>*x^<span class="number">92</span> + <span class="number">35805</span>*x^<span class="number">91</span> + <span class="number">19391</span>*x^<span class="number">90</span> + <span class="number">30884</span>*x^<span class="number">89</span> + <span class="number">42039</span>*x^<span class="number">88</span> + <span class="number">17292</span>*x^<span class="number">87</span> + <span class="number">4694</span>*x^<span class="number">86</span> + <span class="number">1497</span>*x^<span class="number">85</span> + <span class="number">1744</span>*x^<span class="number">84</span> + <span class="number">31071</span>*x^<span class="number">83</span> + <span class="number">26246</span>*x^<span class="number">82</span> + <span class="number">24402</span>*x^<span class="number">81</span> + <span class="number">22068</span>*x^<span class="number">80</span> + <span class="number">39263</span>*x^<span class="number">79</span> + <span class="number">23703</span>*x^<span class="number">78</span> + <span class="number">21484</span>*x^<span class="number">77</span> + <span class="number">12241</span>*x^<span class="number">76</span> + <span class="number">28821</span>*x^<span class="number">75</span> + <span class="number">32886</span>*x^<span class="number">74</span> + <span class="number">43075</span>*x^<span class="number">73</span> + <span class="number">35741</span>*x^<span class="number">72</span> + <span class="number">19936</span>*x^<span class="number">71</span> + <span class="number">37219</span>*x^<span class="number">70</span> + <span class="number">33411</span>*x^<span class="number">69</span> + <span class="number">8301</span>*x^<span class="number">68</span> + <span class="number">12949</span>*x^<span class="number">67</span> + <span class="number">28611</span>*x^<span class="number">66</span> + <span class="number">42654</span>*x^<span class="number">65</span> + <span class="number">6910</span>*x^<span class="number">64</span> + <span class="number">18523</span>*x^<span class="number">63</span> + <span class="number">31144</span>*x^<span class="number">62</span> + <span class="number">21398</span>*x^<span class="number">61</span> + <span class="number">36298</span>*x^<span class="number">60</span> + <span class="number">27158</span>*x^<span class="number">59</span> + <span class="number">918</span>*x^<span class="number">58</span> + <span class="number">38601</span>*x^<span class="number">57</span> + <span class="number">4269</span>*x^<span class="number">56</span> + <span class="number">5699</span>*x^<span class="number">55</span> + <span class="number">36444</span>*x^<span class="number">54</span> + <span class="number">34791</span>*x^<span class="number">53</span> + <span class="number">37978</span>*x^<span class="number">52</span> + <span class="number">32481</span>*x^<span class="number">51</span> + <span class="number">8039</span>*x^<span class="number">50</span> + <span class="number">11012</span>*x^<span class="number">49</span> + <span class="number">11454</span>*x^<span class="number">48</span> + <span class="number">30450</span>*x^<span class="number">47</span> + <span class="number">1381</span>*x^<span class="number">46</span> + <span class="number">32403</span>*x^<span class="number">45</span> + <span class="number">8202</span>*x^<span class="number">44</span> + <span class="number">8404</span>*x^<span class="number">43</span> + <span class="number">37648</span>*x^<span class="number">42</span> + <span class="number">43696</span>*x^<span class="number">41</span> + <span class="number">34237</span>*x^<span class="number">40</span> + <span class="number">36490</span>*x^<span class="number">39</span> + <span class="number">41423</span>*x^<span class="number">38</span> + <span class="number">35792</span>*x^<span class="number">37</span> + <span class="number">36950</span>*x^<span class="number">36</span> + <span class="number">31086</span>*x^<span class="number">35</span> + <span class="number">38970</span>*x^<span class="number">34</span> + <span class="number">12439</span>*x^<span class="number">33</span> + <span class="number">7963</span>*x^<span class="number">32</span> + <span class="number">16150</span>*x^<span class="number">31</span> + <span class="number">11382</span>*x^<span class="number">30</span> + <span class="number">3038</span>*x^<span class="number">29</span> + <span class="number">20157</span>*x^<span class="number">28</span> + <span class="number">23531</span>*x^<span class="number">27</span> + <span class="number">32866</span>*x^<span class="number">26</span> + <span class="number">5428</span>*x^<span class="number">25</span> + <span class="number">21132</span>*x^<span class="number">24</span> + <span class="number">13443</span>*x^<span class="number">23</span> + <span class="number">28909</span>*x^<span class="number">22</span> + <span class="number">42716</span>*x^<span class="number">21</span> + <span class="number">6567</span>*x^<span class="number">20</span> + <span class="number">24744</span>*x^<span class="number">19</span> + <span class="number">8727</span>*x^<span class="number">18</span> + <span class="number">14895</span>*x^<span class="number">17</span> + <span class="number">28172</span>*x^<span class="number">16</span> + <span class="number">30903</span>*x^<span class="number">15</span> + <span class="number">26608</span>*x^<span class="number">14</span> + <span class="number">27314</span>*x^<span class="number">13</span> + <span class="number">42224</span>*x^<span class="number">12</span> + <span class="number">42551</span>*x^<span class="number">11</span> + <span class="number">37726</span>*x^<span class="number">10</span> + <span class="number">11203</span>*x^<span class="number">9</span> + <span class="number">36816</span>*x^<span class="number">8</span> + <span class="number">5537</span>*x^<span class="number">7</span> + <span class="number">20301</span>*x^<span class="number">6</span> + <span class="number">17591</span>*x^<span class="number">5</span> + <span class="number">41279</span>*x^<span class="number">4</span> + <span class="number">7999</span>*x^<span class="number">3</span> + <span class="number">33753</span>*x^<span class="number">2</span> + <span class="number">34551</span>*x + <span class="number">9659</span></span><br></pre></td></tr></table></figure>
<h3 id="解密-1">解密</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PHI = (p ** P.degree() - <span class="number">1</span>) * (p ** Q.degree() - <span class="number">1</span>)</span><br><span class="line">D = inverse_mod(e, PHI)</span><br><span class="line">m = c ** D</span><br><span class="line">flag = <span class="built_in">bytes</span>(m.<span class="built_in">list</span>())</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&#x27;watevr&#123;RSA_from_ikea_is_fun_but_insecure#k20944uehdjfnjd335uro&#125;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure>
<p>其中需要注意的是，对于多项式来说，<span class="math inline">\(\varphi(N)\)</span> 应该是与 <span class="math inline">\(N\)</span>
没有公共多项式的且不高于其幂级的多项式的个数，即 <span class="math display">\[
\varphi(N)=(pow(43753,65)-1)*(pow(43753,112)-1)
\]</span></p>
<h1 id="rsa-攻击">RSA 攻击</h1>
<h2 id="分解模数n">分解模数N</h2>
<ol type="1">
<li><p>(推荐) 使用在线网站 http://www.factordb.com/index.php
查询素数分解</p></li>
<li><p>使用 yafu 工具本地分解质因数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; ./yafu64.exe</span><br><span class="line"><span class="built_in">factor</span>(911934970359)</span><br></pre></td></tr></table></figure>
<p>回显为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">fac: factoring 911934970359</span><br><span class="line">fac: using pretesting plan: normal</span><br><span class="line">fac: no tune info: using qs/gnfs crossover of 95 digits</span><br><span class="line">div: primes less than 10000</span><br><span class="line"><span class="built_in">fmt</span>: 1000000 iterations</span><br><span class="line">Total factoring time = 0.0080 seconds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">***factors found***</span><br><span class="line"></span><br><span class="line">P1 = 3</span><br><span class="line">P1 = 7</span><br><span class="line">P2 = 97</span><br><span class="line">P9 = 447685307</span><br><span class="line"></span><br><span class="line">ans = 1</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="邻近因数-pq-分解">邻近因数 <span class="math inline">\((p,q)\)</span> 分解</h2>
<h3 id="特征">特征</h3>
<p><span class="math inline">\((p,q)\)</span> 是邻近的大素数</p>
<h3 id="脚本">脚本</h3>
<p>也可以使用 yafu 进行分解，这里给出 Sagemath 的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">n=<span class="number">177606504836499246970959030226871608885969321778211051080524634084516973331441644993898029573612290095853069264036530459253652875586267946877831055147546910227100566496658148381834683037366134553848011903251252726474047661274223137727688689535823533046778793131902143444408735610821167838717488859902242863683</span></span><br><span class="line">c=<span class="number">1457390378511382354771000540945361168984775052693073641682375071407490851289703070905749525830483035988737117653971428424612332020925926617395558868160380601912498299922825914229510166957910451841730028919883807634489834128830801407228447221775264711349928156290102782374379406719292116047581560530382210049</span></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">pp = isqrt(n)</span><br><span class="line">qq = pp</span><br><span class="line"><span class="keyword">while</span> pp * qq != n:</span><br><span class="line">    pp = next_prime(pp)</span><br><span class="line">    qq = n // pp</span><br><span class="line">p, q = pp, qq</span><br></pre></td></tr></table></figure>
<h2 id="共模数攻击">共模数攻击</h2>
<h3 id="特征-1">特征</h3>
<p>若干次加密，e不同，N相同，m相同。</p>
<h3 id="原理">原理</h3>
<p>由于使用公钥对 <span class="math inline">\((N,e_1)\)</span>与<span class="math inline">\((N,e_2)\)</span> 加密明文<span class="math inline">\(m\)</span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c1 = <span class="built_in">pow</span>(m, e1, N)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m, e2, N)</span><br></pre></td></tr></table></figure>
<p>故使用私钥对 <span class="math inline">\((N,d_1)\)</span>与<span class="math inline">\((N,d_2)\)</span> 可以得到相同明文<span class="math inline">\(m\)</span></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = pow(c1, d1, N)</span><br><span class="line">m = pow(c2, d2, N)</span><br></pre></td></tr></table></figure>
<p>这时我们只需已知<span class="math inline">\(c_1,c_2,e_1,e_2,N\)</span>则可以绕过<span class="math inline">\(d_1,d_2\)</span>直接恢复明文<span class="math inline">\(m\)</span></p>
<p>信息安全数学基础证明如下：</p>
<p>假设公钥共模且互素，则有 <span class="math display">\[
\gcd(e_1,e_2)=1
\]</span> 即 <span class="math display">\[
e_1x+e_2y=1
\]</span> 其中<span class="math inline">\(x,y\)</span>皆为整数，一正一负。</p>
<p>利用扩展欧几里得算法可以求得解<span class="math inline">\((x,y)\)</span>，在这里不妨设<span class="math inline">\(x\)</span>为正，<span class="math inline">\(y\)</span>为负，利用模运算性质得 <span class="math display">\[
c_1^xc_2^y=m^{e_1x}m^{e_2y}=m^{e_1x+e_2y}=m\pmod{n}
\]</span></p>
<p>特别地，当 <span class="math inline">\(\gcd(e_1,e_2)=g\)</span>
较小时，也可以构造为： <span class="math display">\[
c_1^xc_2^y=m^{e_1x}m^{e_2y}=m^{e_1x+e_2y}=m^g\pmod{n}
\]</span> 随后进行低加密指数攻击。</p>
<h3 id="实现">实现</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcdext</span><br><span class="line">n = <span class="number">0xa6241c28743fbbe4f2f67cee7121497f622fd81947af30f327fb028445b39c2d517ba7fdcb5f6ac9e6217205f8ec9576bdec7a0faef221c29291c784eed393cd95eb0d358d2a1a35dbff05d6fa0cc597f672dcfbeecbb14bd1462cb6ba4f465f30f22e595c36e6282c3e426831d30f0479ee18b870ab658a54571774d25d6875</span></span><br><span class="line">e1 = <span class="number">0x3045</span></span><br><span class="line">e2 = <span class="number">0xff4d</span></span><br><span class="line">c1 = <span class="number">0x5d1e39bc751108ec0a1397d79e63c013d238915d13380ae649e84d7d85ebcffbbc35ebb18d2218ccbc5409290dfa8a4847e5923c3420e83b1a9d7aa67190dc0d34711cce261665c64c28ed2834394d4b181926febf7eb685f9ce81f36c7fb72798da3a14a123287171d26e084948aab0fba81c53f10b5696fc291006254ee690</span></span><br><span class="line">c2 = <span class="number">0x3d90f2bec4fe02d8ce4cece3ddb6baed99337f7e6856eef255445741b5cfe378390f058679d70236e51be4746db4c207f274c40b092e24f8c155a0957867e84dca48e27980af488d2615a280c6eadec2f1d30b95653b1ee3135e2edff100dd2c529994f846722f811348b082d0bec7cfab579a4bd0ab789928b1bebed68d628f</span></span><br><span class="line">g, r, s = gcdext(e1, e2)</span><br><span class="line">m = <span class="built_in">pow</span>(c1, r, n) * <span class="built_in">pow</span>(c2, s, n) % n</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure>
<h2 id="公约数攻击">公约数攻击</h2>
<h3 id="特征-2">特征</h3>
<p>多个n，均不相同，并且都是2048bit，4096bit级别，并且明文都没什么联系。</p>
<h3 id="原理-1">原理</h3>
<p>使用公约数求出共同的素数因子</p>
<h3 id="实现-1">实现</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n1 = <span class="number">9051013965404084482870087864821455535159008696042953021965631089095795348830954383127323853272528967729311045179605407693592665683311660581204886571146327720288455874927281128121117323579691204792399913106627543274457036172455814805715668293705603675386878220947722186914112990452722174363713630297685159669328951520891938403452797650685849523658191947411429068829734053745180460758604283051344339641429819373112365211739216160420494167071996438506850526168389386850499796102003625404245645796271690310748804327</span></span><br><span class="line">n2 = <span class="number">13225948396179603816062046418717214792668512413625091569997524364243995991961018894150059207824093837420451375240550310050209398964506318518991620142575926623780411532257230701985821629425722030608722035570690474171259238153947095310303522831971664666067542649034461621725656234869005501293423975184701929729170077280251436216167293058560030089006140224375425679571181787206982712477261432579537981278055755344573767076951793312062480275004564657590263719816033564139497109942073701755011873153205366238585665743</span></span><br><span class="line">p = gmpy2.gcd(n1, n2)</span><br><span class="line">q1 = n1 / p</span><br><span class="line">q2 = n2 / p</span><br></pre></td></tr></table></figure>
<h2 id="n-与-varphin-分解"><span class="math inline">\(N\)</span> 与
<span class="math inline">\(\varphi(N)\)</span> 分解</h2>
<h3 id="原理-2">原理</h3>
<p>我们已知 <span class="math display">\[
\begin{align}
N&amp;=pq\\
\varphi(N)&amp;=(p-1)(q-1)\\
&amp;=pq-(p+q)+1\\
&amp;=N-(p+q)+1
\end{align}
\]</span> 我们不妨构建一个二次方程，这个二次方程的两根之和为 <span class="math inline">\(x_1+x_2=p+q\)</span>，两根之积为 <span class="math inline">\(x_1x_2=pq\)</span>，即方程： <span class="math display">\[
x^2+(\varphi(N)-N-1)x+N=0
\]</span> 该方程的解即为 <span class="math inline">\((p,q)\)</span></p>
<p>特别地，如果给予的是 <span class="math inline">\(N\)</span> 与 <span class="math inline">\(k\varphi(N)\)</span>，也有可能是 <span class="math inline">\(k\varphi(N)=ed-1\)</span></p>
<p>我们可以计算出 <span class="math display">\[
k=\frac{k\varphi(N)}{N}+1=k-\left \lceil \frac{p+q+1}{N} \right \rceil
+1
\]</span> 其中一定存在 <span class="math display">\[
\left \lceil \frac{p+q+1}{N} \right \rceil=1
\]</span> 所以 <span class="math inline">\(k\)</span> 一定就在 <span class="math inline">\(\displaystyle\frac{k\varphi(N)}{N}\)</span>
附近。</p>
<blockquote>
<p>当 <span class="math inline">\(N\)</span> 位数足够大时，<span class="math inline">\(k=\frac{k\varphi(N)}{N}+1\)</span> 是一定的。</p>
</blockquote>
<h2 id="低加密指数攻击">低加密指数攻击</h2>
<h3 id="特征-3">特征</h3>
<p><span class="math inline">\(e\)</span>和<span class="math inline">\(m\)</span>都特小，例如<span class="math inline">\(e=3\)</span></p>
<h3 id="原理-3">原理</h3>
<p>在 RSA 中 e 也称为加密指数。</p>
<p>由于 e 是可以随意选取的，选取小一点的 e
可以缩短加密时间，但是选取不当的话，就会造成安全问题。</p>
<p>若<span class="math inline">\(m^3&lt;n\)</span>，即<span class="math inline">\(c=m^3\)</span></p>
<p>若<span class="math inline">\(m^3&gt;n\)</span>但并非<span class="math inline">\(m^3\gg n\)</span>，即<span class="math inline">\(c=(m^3+i*n)\ mod\ n\)</span>，其中<span class="math inline">\(i\)</span>是我们需要爆破的系数</p>
<h3 id="实现-2">实现</h3>
<ul>
<li><p>若<span class="math inline">\(m^3&lt;n\)</span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n= <span class="number">22885480907469109159947272333565375109310485067211461543881386718201442106967914852474989176175269612229966461160065872310916096148216253429849921988412342732706875998100337754561586600637594798877898552625378551427864501926224989873772743227733285336042475675299391051376624685754547818835551263597996620383338263448888107691240136257201191331617560711786674975909597833383395574686942099700631002290836152972352041024137872983284691831292216787307841877839674258086005814225532597955826353796634417780156185485054141684249037538570742860026295194559710972266059844824388916869414355952432189722465103299013237588737</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c= <span class="number">15685364647213619014219110070569189770745535885901269792039052046431067708991036961644224230125219358149236447900927116989931929305133870392430610563331490276096858863490412102016758082433435355613099047001069687409209484751075897343335693872741</span></span><br><span class="line">m, flag = gmpy2.iroot(c, e)</span><br><span class="line"><span class="keyword">if</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;m=<span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;could not decode m&quot;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>若<span class="math inline">\(m^3&gt;n\)</span>但并非<span class="math inline">\(m^3\gg n\)</span> (这里需要跑比较久)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n = <span class="number">114976915747243387792157708464120735018971336213935438953074748276198282761939060395482051056351068439137722626185590043024556656813730840050547350912425438364703854627760482842307943026011880815011654341047422453012558617703411700393668892701036222135444420377515575624398723436532681305293727164639582093389</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = <span class="number">5828813410620741112500628876643872258919868379601617907887884191584237969605489971465692568848339200057188383649365078832766143513766368216471491824042974016773526107276856706832404477882581400769791378958901067683158857990261489285951805740071223765359992165262854641069674603160977034446644199945940251030</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    m, flag = gmpy2.iroot(c + i * n, e)</span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;m=<span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    i += <span class="number">1</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="e1-攻击"><span class="math inline">\(e=1\)</span> 攻击</h2>
<h3 id="实现-3">实现</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">0x180be86dc898a3c3a710e52b31de460f8f350610bf63e6b2203c08fddad44601d96eb454a34dab7684589bc32b19eb27cffff8c07179e349ddb62898ae896f8c681796052ae1598bd41f35491175c9b60ae2260d0d4ebac05b4b6f2677a7609c2fe6194fe7b63841cec632e3a2f55d0cb09df08eacea34394ad473577dea5131552b0b30efac31c59087bfe603d2b13bed7d14967bfd489157aa01b14b4e1bd08d9b92ec0c319aeb8fedd535c56770aac95247d116d59cae2f99c3b51f43093fd39c10f93830c1ece75ee37e5fcdc5b174052eccadcadeda2f1b3a4a87184041d5c1a6a0b2eeaa3c3a1227bc27e130e67ac397b375ffe7c873e9b1c649812edcd</span></span><br><span class="line">e = <span class="number">0x1</span></span><br><span class="line">c = <span class="number">0x4963654354467b66616c6c735f61706172745f736f5f656173696c795f616e645f7265617373656d626c65645f736f5f63727564656c797d</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="comment"># i 可以取很多</span></span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="number">10</span>:</span><br><span class="line">    m = c + i * n</span><br><span class="line">    <span class="built_in">print</span>(m)</span><br><span class="line">    i += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="低加密指数广播攻击">低加密指数广播攻击</h2>
<h3 id="特征-4">特征</h3>
<p>三组加密的参数和明密文，其中题目很明确地能告诉你这三组的明文都是一样的，并且e都取了一个较小的数字。</p>
<h3 id="原理-4">原理</h3>
<p>如果选取的加密指数较低，并且使用了相同的加密指数给一个接受者的群发送相同的信息，那么可以进行广播攻击得到明文。</p>
<p>例如当<span class="math inline">\(e=3\)</span>时，有以下等式成立：
<span class="math display">\[
\begin{aligned}
c_1&amp;=pow(m,e,n_1)\\
c_2&amp;=pow(m,e,n_2)\\
c_3&amp;=pow(m,e,n_3)\\
&amp;\vdots
\end{aligned}
\]</span> 对上列等式运用中国剩余定理，得到 <span class="math display">\[
c_x=pow(m,e,n_1\times n_2\times n_3\times \cdots)
\]</span></p>
<p>随后再进行低加密指数攻击。</p>
<h3 id="实现-4">实现</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CRT</span>(<span class="params">clist, nlist</span>):</span><br><span class="line">    N = reduce(<span class="keyword">lambda</span> x, y: x * y, nlist)</span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> c, n <span class="keyword">in</span> <span class="built_in">zip</span>(clist, nlist):</span><br><span class="line">        m = N // n</span><br><span class="line">        d, r, s = gmpy2.gcdext(n, m)</span><br><span class="line">        <span class="keyword">if</span> d != <span class="number">1</span>: <span class="keyword">raise</span> Exception(<span class="string">&quot;Input not pairwise co-prime&quot;</span>)</span><br><span class="line">        result += c * s * m</span><br><span class="line">    <span class="keyword">return</span> result % N, N</span><br><span class="line">e = <span class="number">9</span></span><br><span class="line">n = [<span class="number">142782424368849674771976671955176187834932417027468006479038058385550042422280158726561712259205616626939123504489410624745195777853423961104590708231562726165590769610040722589287393102301338152085670464005026301781192671834390892019478189768725018303217559795377795540494239283891894830166363576205812991157</span>, <span class="number">153610425077816156109768509904751446801233412970601397035720458311275245730833227428213917577405780162151444202393431444812010569489900435979730559895340377469612234558042643742219128033827948585534761030527275423811282367831985007507137144308704413007806012914286105842311420933479771294576841956749281552971</span>, <span class="number">152540067782701001222493009941492423063369171831039847414320547494725020441901272486665728360741395415762864872737675660423920609681185809510355937534756399208661762715484879562585724584849261266873624875852300611683382543315580370484972470694466195837255994159609193239840228218925381488410059939975556977947</span>, <span class="number">125842716702134814646356078531900645012495638692517778270527426844383063904041812273637776798591687732598509470005151551320457132061693618473039437320011446697406190781306264437609046721508738109650829547010385875425097336266103994639126319889016342284747700714199556143378526590058467791687837422897022829661</span>, <span class="number">116144389285266462769913139639175922392318396923181100785008570884082681963637784423143843845816350379438789947802939701820129805341796427821894273985551331666719808355412080909245720551238149511778060242720419584504473490216670437024863860559347959698828131475160058721701582089480924088773887932997353631767</span>, <span class="number">127833907448946785858374094953899556339175475846831397383049660262333005992005484987913355932559627279178940862787593749842796469355336182379062826441222705075178971785791223706944120681105575965622931327112817747065200324610697178273898956820957640413744954233327851461318200323486469677469950386824833536523</span>, <span class="number">130561613227079478921314550968562766645507834694262831586725464124109153306162445639759476845681271537955934718244296904503168256991962908095007040044300188572466395275317838178325500238288302672390013747102961340256309124310478931896245221622317302428447389760864327859640573452084295225059466376349115703119</span>, <span class="number">115953389401040751013569404909249958538962411171147823610874077094621794755967854844224923689925397631692572916641171075740839099217316101334941033937183815345038898177087515909675028366437302462022970987947264115373697445950951595479758872029099661065186221250394358255523574834723958546450323357472451930993</span>, <span class="number">143437107845384843564651522639125300763388830136500260725097766445883003928355325003575359566631064630487365774344508496878731109174874449170057678821440711511966073934025028100604234445470976333825866939923998344367645612128590820812489407412175198698290167077116185959180877334222693344630253253476594907313</span>]</span><br><span class="line">c = [<span class="number">85033868418784308573673709960700777350314426427677627319697346811123742342359072170220428874952996988431950989321281905284522596263957356289624365171732095210045916218066135140320107686084053271623461104022705353814233772164502775939590711842361956121603943483040254727995655776263673058788416722141673409688</span>, <span class="number">66065963470666895005407449599703926269325406456711861190876894466341571726360462706664546294453572319565476664348345756905411939632955966517708138047546806602828064213238537646393524578984547577761559965654539771172357089802682793169968961304179886652390277814477825753096636750388350662980872556701402397564</span>, <span class="number">116011740820520887443111656288411611070614127688662643257265381793048354928820176624229624692124188995846076431510548507016903260774215950803926107831505634778278712070141663189086436127990584944132764896694777031370995058271038329228336417590284517922855284619653301817355115583540545182119702335431334401666</span>, <span class="number">97640420284096094887471273365295984332267897927392169402918423863919914002451127544715668846623138003564829254309568918651163254043205129883843425179687841236818720463784828905460885026290909768599562386370732119591181513319548915478512030197629196018254041500662654260834562708620760373487652389789200792120</span>, <span class="number">8112507653841374573057048967617108909055624101437903775740427861003476480616929517639719198652146909660899632120639789106782550275648578142883715280547602249589837441805676364041484345030575130408744621981440093280624046635769338568542048839419939250444929802135605724150484414516536378791500915047844188300</span>, <span class="number">36792148360808115566234645242678223867680969786675055638670907933041180936164293809961667801099516457636164692292891528415720085345494773373966277807505798679784807614784581861287048096977968620964436947452527540958289441390882589051225367658014709290392321808926567572528170531844664734909469690750971883323</span>, <span class="number">53043093283305492238903255767698153246673671181809989362223466090875767705978690531154079519999671834688647277179370374802495005937892824566602423646978168777735383632928274082669949750078161820002768640908750005814934158829006019656592134357897586040866207754535586785064545866404380204728594863102313407789</span>, <span class="number">88499407133762624445946519155722583633934260410706930537441122463087556094734626189377091740335667052378955691250910459790202385799502439716173363179773811920751410726795431402796346647688144853156900427797933862087074385441977254140336390678022955770879265490567987868532251217565094093318626424653599450992</span>, <span class="number">138337520305048557335599940473834485492131424901034295018189264168040969172072024612859307499682986987325414798210700710891033749119834960687318156171051379643844580970963540418974136891389303624057726575516576726845229494107327508855516437230240365759885913142671816868762838801720492804671259709458388192984</span>]</span><br><span class="line">x, n = CRT(c, n)</span><br><span class="line">m, flag = gmpy2.iroot(x, e)</span><br><span class="line"><span class="keyword">if</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;m=<span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;could not decode m&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="扩展">扩展</h3>
<p>如果每个明文都是线性映射后才加密的，即 <span class="math display">\[
c_i=(a_im+b_i)^e\pmod{n_i}
\]</span> 这个时候将转化为 Håstad 问题。</p>
<p>我们手里有 <span class="math inline">\(e\)</span> 个方程，如果 <span class="math inline">\(e\)</span>
个模数都是互质的，使用中国剩余定理得到一个多项式，此多项式必然仅有唯一解
<span class="math inline">\(m\)</span>。</p>
<p>生成代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_prime</span>(<span class="params">e, nbits = <span class="number">128</span></span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = getPrime(nbits)</span><br><span class="line">        q = getPrime(nbits)</span><br><span class="line">        phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> gcd(e, phi) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line">m = <span class="number">12345678909876543210123456789</span></span><br><span class="line">e = <span class="number">5</span></span><br><span class="line">cnt = e</span><br><span class="line">A = [random.getrandbits(<span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt)]</span><br><span class="line">B = [random.getrandbits(<span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt)]</span><br><span class="line"></span><br><span class="line">Ns = []</span><br><span class="line">Cs = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt):</span><br><span class="line">    p, q = gen_prime(e)</span><br><span class="line">    n = p * q</span><br><span class="line">    <span class="keyword">assert</span> m &lt; n</span><br><span class="line">    Ns.append(n)</span><br><span class="line">    c = <span class="built_in">pow</span>(A[i] * m + B[i], e, n)</span><br><span class="line">    Cs.append(c)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;Ns = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;A = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;B = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;e = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;Cs = &#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>求解代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">Ns = [<span class="number">54083343375234662200099757715655786732319849776299053669258471280425520446563</span>, <span class="number">57451400898890261568311471323401021425649134079480527619499816018137641523101</span>, <span class="number">62361269389224974168958185709758463920746172022272059244582082311163541212863</span>, <span class="number">68958389071922182719189344062138335193303205914947842087348429706174374534933</span>, <span class="number">76868740862563485837918666110296168275535830960508353132527603298274280231651</span>]</span><br><span class="line">A = [<span class="number">1783329078</span>, <span class="number">4116509288</span>, <span class="number">1610410794</span>, <span class="number">937258067</span>, <span class="number">3088738863</span>]</span><br><span class="line">B = [<span class="number">1926001878</span>, <span class="number">88533882</span>, <span class="number">4144178569</span>, <span class="number">2673089177</span>, <span class="number">1693394020</span>]</span><br><span class="line">e = <span class="number">5</span></span><br><span class="line">Cs = [<span class="number">36267245963551737844539070991485903279725583484166321759824831482629419234481</span>, <span class="number">28560773802819161789081370635071282975025711430638171046096333084125012412026</span>, <span class="number">51931278891526114578870060444759610215259255866146720938080914934508882168071</span>, <span class="number">13232544162120977310144792467208197733399011581100174942873170595969028745121</span>, <span class="number">37591263432669152518061731513326056670793427134029106244119790273766985095248</span>]</span><br><span class="line"></span><br><span class="line">PR = PolynomialRing(ZZ, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">x = PR.gen()</span><br><span class="line"></span><br><span class="line">Fs = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt):</span><br><span class="line">    f = (A[i] * x + B[i]) ** e - Cs[i]</span><br><span class="line">    Fs.append(f)</span><br><span class="line">F = crt(Fs, Ns)</span><br><span class="line">M = prod(Ns)</span><br><span class="line">FF = F.change_ring(Zmod(M))</span><br><span class="line">m = FF.monic().small_roots()</span><br><span class="line"><span class="built_in">print</span>(m)</span><br></pre></td></tr></table></figure>
<h3 id="扩展的扩展">扩展的扩展</h3>
<p>在 Håstad
问题中，每个多项式的阶数是相同的，如果每个多项式的阶数不同（即加密用的
<span class="math inline">\(e\)</span> 不同），这将化为 SMUPE 问题。</p>
<p>这个时候我们只需要将每个多项式的阶数统一即可。</p>
<h2 id="低解密指数攻击-wiener-attack">低解密指数攻击 (Wiener
Attack)</h2>
<h3 id="特征-5">特征</h3>
<p><span class="math inline">\(e\)</span>特别大</p>
<h3 id="原理-5">原理</h3>
<p>与低加密指数相同，低解密指数可以加快解密的过程，但是也带来了安全问题。种基于连分数(一个数论当中的问题)的特殊攻击类型就可以危害
RSA 的安全。此时需要满足：<span class="math inline">\(q&lt;p&lt;2q\)</span>。如果满足上述条件，通过
Wiener Attack (维纳攻击) 可以在多项式时间中分解N。</p>
<h3 id="实现-5">实现</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">x, y</span>):  <span class="comment"># 使用辗转相处将分数 x/y 转为连分数的形式</span></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">while</span> y:</span><br><span class="line">        res.append(x//y)</span><br><span class="line">        x, y = y, x % y</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">continued_fraction</span>(<span class="params">sub_res</span>):</span><br><span class="line">    numerator, denominator = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> sub_res[::-<span class="number">1</span>]:  <span class="comment"># 从sublist的后面往前循环</span></span><br><span class="line">        denominator, numerator = numerator, i*numerator+denominator</span><br><span class="line">    <span class="keyword">return</span> denominator, numerator  <span class="comment"># 得到渐进分数的分母和分子，并返回</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 求解每个渐进分数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_fraction</span>(<span class="params">x, y</span>):</span><br><span class="line">    res = transform(x, y)</span><br><span class="line">    <span class="comment"># 将连分数的结果逐一截取以求渐进分数</span></span><br><span class="line">    res = <span class="built_in">list</span>(<span class="built_in">map</span>(continued_fraction, (res[<span class="number">0</span>:i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(res)))))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_pq</span>(<span class="params">a, b, c</span>):  <span class="comment"># 由p+q和pq的值通过维达定理来求解p和q</span></span><br><span class="line">    par = gmpy2.isqrt(b*b-<span class="number">4</span>*a*c)  <span class="comment"># 由上述可得，开根号一定是整数，因为有解</span></span><br><span class="line">    x1, x2 = (-b+par)//(<span class="number">2</span>*a), (-b-par)//(<span class="number">2</span>*a)</span><br><span class="line">    <span class="keyword">return</span> x1, x2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wienerAttack</span>(<span class="params">e, n</span>):</span><br><span class="line">    <span class="keyword">for</span> (d, k) <span class="keyword">in</span> sub_fraction(e, n):  <span class="comment"># 用一个for循环来注意试探e/n的连续函数的渐进分数，直到找到一个满足条件的渐进分数</span></span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>:  <span class="comment"># 可能会出现连分数的第一个为0的情况，排除</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> (e*d-<span class="number">1</span>) % k != <span class="number">0</span>:  <span class="comment"># ed=1 (mod φ(n)) 因此如果找到了d的话，(ed-1)会整除φ(n),也就是存在k使得(e*d-1)//k=φ(n)</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        phi = (e*d-<span class="number">1</span>)//k  <span class="comment"># 这个结果就是 φ(n)</span></span><br><span class="line">        px, qy = get_pq(<span class="number">1</span>, n-phi+<span class="number">1</span>, n)</span><br><span class="line">        <span class="keyword">if</span> px*qy == n:</span><br><span class="line">            p, q = <span class="built_in">abs</span>(<span class="built_in">int</span>(px)), <span class="built_in">abs</span>(<span class="built_in">int</span>(qy))  <span class="comment"># 可能会得到两个负数，负负得正未尝不会出现</span></span><br><span class="line">            <span class="comment"># 求ed=1 (mod  φ(n))的结果，也就是e关于 φ(n)的乘法逆元d</span></span><br><span class="line">            d = gmpy2.invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">            <span class="keyword">return</span> d</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;该方法不适用&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">507419170088344932990702256911694788408493968749527614421614568612944144764889717229444020813658893362983714454159980719026366361318789415279417172858536381938870379267670180128174798344744371725609827872339512302232610590888649555446972990419313445687852636305518801236132032618350847705234643521557851434711389664130274468354405273873218264222293858509477860634889001898462547712800153111774564939279190835857445378261920532206352364005840238252284065587291779196975457288580812526597185332036342330147250312262816994625317482869849388424397437470502449815132000588425028055964432298176942124697105509057090546600330760364385753313923003549670107599757996810939165300581847068233156887269181096893089415302163770884312255957584660964506028002922164767453287973102961910781312351686488047510932997937700597992705557881172640175117476017503918294534205898046483981707558521558992058512940087192655700351675718815723840568640509355338482631416345193176708501897458649841539192993142790402734898948352382350766125000186026261167277014748183012844440603384989647664190074853086693408529737767147592432979469020671772152652865219092597717869942730499507426269170189547020660681363276871874469322437194397171763927907099922324375991793759</span></span><br><span class="line">e = <span class="number">77310199867448677782081572109343472783781135641712597643597122591443011229091533516758925238949755491395489408922437493670252550920826641442189683907973926843505436730014899918587477913032286153545247063493885982941194996251799882984145155733050069564485120660716110828110738784644223519725613280140006783618393995138076030616463398284819550627612102010214315235269945251741407899692274978642663650687157736417831290404871181902463904311095448368498432147292938825418930527188720696497596867575843476810225152659244529481480993843168383016583068747733118703000287423374094051895724494193455175131120243097065270804457787026492578916584536863548445813916819417857064037664101684455000184987531252344582899589746272173970083733130106407810619258077266603898529285634495710846838011858287024329514491058790557305041389614650730267774482954666726949886313386881066593946789460028399523245777171320319444673551268379126203862576627540177888290265714418064334752499940587750374552330008143708562065940245637685833371348603338834447212248648869514585047871442060412622164276894766238383894693759347590977926306581080390685360615407766600573527565016914830132066428454738135380178959590692145577418811677639050929791996313180297924833690095</span></span><br><span class="line">c = <span class="number">165251729917394529793163344300848992394021337429474789711805041655116845722480301677817165053253655027459227404782607373107477419083333844871948673626672704233977397989843349633720167495862807995411682262559392496273163155214888276398332204954185252030616473235814999366132031184631541209554169938146205402400412307638567132128690379079483633171535375278689326189057930259534983374296873110199636558962144635514392282351103900375366360933088605794654279480277782805401749872568584335215630740265944133347038070337891035560658434763924576508969938866566235926587685108811154229747423410476421860059769485356567301897413767088823807510568561254627099309752215808220067495561412081320541540679503218232020279947159175547517811501280846596226165148013762293861131544331444165070186672186027410082671602892508739473724143698396105392623164025712124329254933353509384748403154342322725203183050328143736631333990445537119855865348221215277608372952942702104088940952142851523651639574409075484106857403651453121036577767672430612728022444370874223001778580387635197325043524719396707713385963432915855227152371800527536048555551237729690663544828830627192867570345853910196397851763591543484023134551876591248557980182981967782409054277224</span></span><br><span class="line">d = wienerAttack(e, n)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>也可以使用 https://github.com/pablocelayes/rsa-wiener-attack
的脚本</p>
</blockquote>
<h2 id="dp-dq-泄露">dp &amp; dq 泄露</h2>
<h3 id="特征-6">特征</h3>
<p>题目仅给出<span class="math inline">\(p,q,dp,dq,c\)</span>，不给公钥<span class="math inline">\(e\)</span></p>
<h3 id="原理-6">原理</h3>
<p>已知 <span class="math inline">\(dp=inverse(e,p-1)\)</span>，<span class="math inline">\(dq=inverse(e,q-1)\)</span>，使用 CRT 可得 <span class="math inline">\(d=inverse(e,(p-1)(q-1))\)</span></p>
<p>对 <span class="math inline">\(m\)</span> 也是同理</p>
<h3 id="实现-6">实现</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">dp, dq, p, q, c</span>):</span><br><span class="line">    InvQ = gmpy2.invert(q,p)</span><br><span class="line">    mp = <span class="built_in">pow</span>(c,dp,p)</span><br><span class="line">    mq = <span class="built_in">pow</span>(c,dq,q)</span><br><span class="line">    m = (((mp - mq) * InvQ) % p) * q + mq</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">p=<span class="number">0xf85d730bbf09033a75379e58a8465f8048b8516f8105ce2879ce774241305b6eb4ea506b61eb7e376d4fcd425c76e80cb748ebfaf3a852b5cf3119f028cc5971</span></span><br><span class="line">q=<span class="number">0xc1f34b4f826f91c5d68c5751c9af830bc770467a68699991be6e847c29c13170110ccd5e855710950abab2694b6ac730141152758acbeca0c5a51889cbe84d57</span></span><br><span class="line">dp=<span class="number">0xf7b885a246a59fa1b3fe88a2971cb1ee8b19c4a7f9c1a791b9845471320220803854a967a1a03820e297c0fc1aabc2e1c40228d50228766ebebc93c97577f511</span></span><br><span class="line">dq=<span class="number">0x865fe807b8595067ff93d053cc269be6a75134a34e800b741cba39744501a31cffd31cdea6078267a0bd652aeaa39a49c73d9121fafdfa7e1131a764a12fdb95</span></span><br><span class="line">c=<span class="number">0xae05e0c34e2ba4ca3536987cc2cfc3f1f7f53190164d0ac50b44832f0e7224c6fdeebd2c91e3991e7d179c26b1b997295dc9724925ba431f527fba212703a0d14a34ce133661ae0b6001ee326303d6ccdc27dbd94e0987fae25a84f197c1535bdac9094bfb3846b7ca696b2e5082bea7bff804da275772ca05dd51b185a4fc30</span></span><br><span class="line"></span><br><span class="line">m = dec(dp,dq,p,q,c)</span><br></pre></td></tr></table></figure>
<h2 id="d_p-泄露"><span class="math inline">\(d_p\)</span> 泄露</h2>
<h3 id="原理-7">原理</h3>
<p>已知 <span class="math display">\[
d_p\equiv e^{-1}\pmod{p-1}
\]</span> 由费马小定理可知，对于任意整数 <span class="math inline">\(a\)</span> 都有 <span class="math display">\[
a^{ed_p}=a^{k(p-1)}\equiv a\pmod{p}=a+kp
\]</span> 那么有 <span class="math display">\[
\gcd{(a^{ed_p}-a,n)}=p
\]</span> 由此找到 <span class="math inline">\(p\)</span> 分解 <span class="math inline">\(n\)</span>。</p>
<h3 id="代码">代码</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"></span><br><span class="line">n = <span class="number">248254007851526241177721526698901802985832766176221609612258877371620580060433101538328030305219918697643619814200930679612109885533801335348445023751670478437073055544724280684733298051599167660303645183146161497485358633681492129668802402065797789905550489547645118787266601929429724133167768465309665906113</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">dp = <span class="number">905074498052346904643025132879518330691925174573054004621877253318682675055421970943552016695528560364834446303196939207056642927148093290374440210503657</span></span><br><span class="line">c = <span class="number">140423670976252696807533673586209400575664282100684119784203527124521188996403826597436883766041879067494280957410201958935737360380801845453829293997433414188838725751796261702622028587211560353362847191060306578510511380965162133472698713063592621028959167072781482562673683090590521214218071160287665180751</span></span><br><span class="line"></span><br><span class="line">p = gcd(<span class="built_in">pow</span>(<span class="number">2</span>, e * dp, n) - <span class="number">2</span>, n)</span><br><span class="line"><span class="keyword">assert</span> n % p == <span class="number">0</span></span><br><span class="line">q = n // p</span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br></pre></td></tr></table></figure>
<h3 id="扩展-1">扩展</h3>
<p>若是仅知道 <span class="math inline">\(e,d_p\)</span>，此时有 <span class="math display">\[
ed_p\equiv 1\pmod{p-1}=1+k_p(p-1)
\]</span> 同时也一定有 <span class="math display">\[
ed\equiv1\pmod{\varphi(n)}=1+k\varphi(n)
\]</span> 其中定然有 <span class="math inline">\(\varphi(n)|(p-1)\)</span>，故 <span class="math display">\[
ed_p-k_p(p-1)\equiv 1\pmod{\varphi(n)}
\]</span> 变形得 <span class="math display">\[
\begin{align}
ed_p&amp;=1+k\varphi(n)+k_p(p-1)\\
&amp;=1+(k\varphi(\frac{n}{p})+k_p)(p-1)\\
&amp;=1+K(p-1)
\end{align}
\]</span> 由大小比例关系可知，<span class="math inline">\(d_p&lt;p-1\)</span> 必然有 <span class="math display">\[
K&lt;e
\]</span> 当 <span class="math inline">\(e\)</span> 较小时可以爆破 <span class="math inline">\(K\)</span> 直接求解得到 <span class="math inline">\(p-1\)</span>。</p>
<h3 id="扩展代码">扩展代码</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">dp = <span class="number">905074498052346904643025132879518330691925174573054004621877253318682675055421970943552016695528560364834446303196939207056642927148093290374440210503657</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e + <span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> (dp * e - <span class="number">1</span>) % i == <span class="number">0</span>:</span><br><span class="line">        p = ((dp * e - <span class="number">1</span>) // i) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;p = &#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="d-泄露攻击"><span class="math inline">\(d\)</span> 泄露攻击</h2>
<h3 id="原理-8">原理</h3>
<p>已知 <span class="math inline">\((n,e,d)\)</span>，第一种方式可以将问题转化为已知
<span class="math inline">\((n,\varphi(n))\)</span>
的问题，在上文中有原理解释。</p>
<p>第二种方式是，我们将 <span class="math inline">\(k\varphi(n)\)</span>
表示为 <span class="math display">\[
ed-1=k\varphi(n)=2^st
\]</span> 即奇数 <span class="math inline">\(t\)</span> 与一个偶数 <span class="math inline">\(2^s\)</span> 相乘。</p>
<p>可以证明得到对于至少一半的 <span class="math inline">\(a\in
Z_n\)</span>，存在一个 <span class="math inline">\(i\in [1,s]\)</span>
满足 <span class="math display">\[
\begin{align}
r=a^{2^{i-1}t}&amp;\neq \pm1\pmod{n}\newline
a^{2^it}&amp;=1\pmod{n}
\end{align}
\]</span> 那么此时，<span class="math inline">\(p=\gcd(r-1,n)\)</span>
是 <span class="math inline">\(n\)</span> 的一个非平凡因子。</p>
<h3 id="代码-1">代码</h3>
<p>已知 <span class="math inline">\((n,\varphi(n))\)</span> 问题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">80642592772746398646558097588687958541171131704233319344980232942965050635113860017117519166348100569115174644678997805783380130114530824798808098237628247236574959152847903491509751809336988273823686988619679739640305091291330211169194377552925908412183162787327977125388852329089751737463948165202565859373</span></span><br><span class="line">e = <span class="number">13521</span></span><br><span class="line">d = <span class="number">14218766449983537783699024084862960813708451888387858392014856544340557703876299258990323621963898510226357248200187173211121827541826897886277531706124228848229095880229718049075745233893843373402201077890407507625110061976931591596708901741146750809962128820611844426759462132623616118530705745098783140913</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">n_with_kphi</span>(<span class="params">n, e, d</span>):</span><br><span class="line">    kphi = e * d - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    k = kphi // n</span><br><span class="line">    <span class="keyword">while</span> kphi % k != <span class="number">0</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    phi = kphi // k</span><br><span class="line">    <span class="comment"># 构建方程 x^2+(\varphi(N)-N-1)x+N=0</span></span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    b = phi - n - <span class="number">1</span></span><br><span class="line">    c = n</span><br><span class="line">    delta = b ** <span class="number">2</span> - <span class="number">4</span> * a * c</span><br><span class="line">    <span class="keyword">if</span> delta &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">from</span> math <span class="keyword">import</span> isqrt</span><br><span class="line">    sqrt_delta = isqrt(delta)</span><br><span class="line">    p = (-b + sqrt_delta) // (<span class="number">2</span> * a)</span><br><span class="line">    q = (-b - sqrt_delta) // (<span class="number">2</span> * a)</span><br><span class="line">    <span class="keyword">if</span> p * q != n:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(n_with_kphi(n, e, d))</span><br></pre></td></tr></table></figure>
<p>第二种暴力破解法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">80642592772746398646558097588687958541171131704233319344980232942965050635113860017117519166348100569115174644678997805783380130114530824798808098237628247236574959152847903491509751809336988273823686988619679739640305091291330211169194377552925908412183162787327977125388852329089751737463948165202565859373</span></span><br><span class="line">e = <span class="number">13521</span></span><br><span class="line">d = <span class="number">14218766449983537783699024084862960813708451888387858392014856544340557703876299258990323621963898510226357248200187173211121827541826897886277531706124228848229095880229718049075745233893843373402201077890407507625110061976931591596708901741146750809962128820611844426759462132623616118530705745098783140913</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">kphi_2st</span>(<span class="params">n, e, d</span>):</span><br><span class="line">    kphi = e * d - <span class="number">1</span></span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> kphi % (<span class="number">2</span> ** s) == <span class="number">0</span>:</span><br><span class="line">        s += <span class="number">1</span></span><br><span class="line">    <span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line">    <span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(e):</span><br><span class="line">        a = randint(<span class="number">2</span>, n - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, s + <span class="number">1</span>):</span><br><span class="line">            r = <span class="built_in">pow</span>(a, kphi // (<span class="number">2</span> ** i), n)</span><br><span class="line">            p = gcd(r - <span class="number">1</span>, n)</span><br><span class="line">            <span class="keyword">if</span> <span class="number">1</span> &lt; p &lt; n <span class="keyword">and</span> n % p == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> p, n // p</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(kphi_2st(n, e, d))</span><br></pre></td></tr></table></figure>
<h2 id="已知-p-高位">已知 <span class="math inline">\(p\)</span>
高位</h2>
<h3 id="原理-9">原理</h3>
<p>已知 <span class="math inline">\(p\)</span> 的一半高位时，可以使用
Coppersmith 方法分解 <span class="math inline">\(N\)</span>。</p>
<p>其中在 Coppersmith 方法里，<span class="math inline">\(X\)</span> 为
<span class="math inline">\(p\)</span> 未知的位数范围，<span class="math inline">\(p&gt;N^\beta\)</span>。</p>
<blockquote>
<p>1024 位需要知道 570 位</p>
<p>512 位需要知道 300 位</p>
</blockquote>
<h3 id="实例">实例</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">p3 = getPrime(<span class="number">512</span>)</span><br><span class="line">q3 = getPrime(<span class="number">512</span>)</span><br><span class="line">N3 = p3*q3</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">pow</span>(msg3,e3,N3)</span><br><span class="line"><span class="built_in">print</span> (e3,N3)</span><br><span class="line"><span class="built_in">print</span> p3&gt;&gt;<span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># phigh = 7117286695925472918001071846973900342640107770214858928188419765628151478620236042882657992902</span></span><br><span class="line"><span class="comment"># N = 113432930155033263769270712825121761080813952100666693606866355917116416984149165507231925180593860836255402950358327422447359200689537217528547623691586008952619063846801829802637448874451228957635707553980210685985215887107300416969549087293746310593988908287181025770739538992559714587375763131132963783147</span></span><br></pre></td></tr></table></figure>
<p>利用 Sagemath 中 <code>small_roots</code> 的参数，变成 Coppersmith
方法求解低位值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">phigh = <span class="number">7117286695925472918001071846973900342640107770214858928188419765628151478620236042882657992902</span></span><br><span class="line">N = <span class="number">113432930155033263769270712825121761080813952100666693606866355917116416984149165507231925180593860836255402950358327422447359200689537217528547623691586008952619063846801829802637448874451228957635707553980210685985215887107300416969549087293746310593988908287181025770739538992559714587375763131132963783147</span></span><br><span class="line"><span class="comment"># 未知的位数</span></span><br><span class="line">kbits = <span class="number">200</span></span><br><span class="line"><span class="comment"># beta值按需修改</span></span><br><span class="line">beta = <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">P.&lt;x&gt; = Zmod(N)[]</span><br><span class="line">f = x + (phigh &lt;&lt; kbits)</span><br><span class="line">p0 = f.small_roots(X=<span class="number">2</span>**kbits, beta=beta)</span><br><span class="line"><span class="keyword">assert</span>(p0)</span><br><span class="line">p0 = p0[<span class="number">0</span>]</span><br><span class="line">p = Integer(f(p0))</span><br><span class="line"><span class="built_in">print</span>(p)</span><br></pre></td></tr></table></figure>
<h2 id="已知-p-低位">已知 <span class="math inline">\(p\)</span>
低位</h2>
<h3 id="原理-10">原理</h3>
<p>假设已知 <span class="math inline">\(p\)</span> 的 <span class="math inline">\(k\)</span> 个低位，那么有： <span class="math display">\[
p \pmod{2^k}=p_0
\]</span> 即 <span class="math display">\[
p=p_0+\alpha\cdot2^k
\]</span> 两边同乘，得到 <span class="math display">\[
n=p_0q+\alpha q\cdot2^k
\]</span> 有 <span class="math display">\[
np_0^{-1}=q+\alpha qp_0^{-1}\cdot2^k
\]</span> 两边同余，得到： <span class="math display">\[
q\pmod{2^k}=np_0^{-1}\pmod{2^k}
\]</span> 换句话说，知道 <span class="math inline">\(p\)</span>
低位，即可求 <span class="math inline">\(q\)</span> 低位。</p>
<h2 id="e-与-varphin-不互素"><span class="math inline">\(e\)</span> 与
<span class="math inline">\(\varphi(n)\)</span> 不互素</h2>
<h3 id="原理-11">原理</h3>
<p>先考虑对于素数 <span class="math inline">\(p\)</span>，满足 <span class="math display">\[
c_p=m^e\pmod{p}
\]</span> 那么有 <span class="math inline">\(d_p=e^{-1}\pmod{p}\)</span>，使得 <span class="math display">\[
m_p\equiv c_p^{d_p}\pmod{p}\equiv m\pmod{p}
\]</span> 当 <span class="math inline">\(\gcd(e,p-1)\neq 1\)</span>
时，此时无法直接求出 <span class="math inline">\(d_p\)</span>（或者说存在多个 <span class="math inline">\(m_p\)</span>），那么我们令 <span class="math inline">\(k=\gcd(e,p-1)\)</span>，那么 <span class="math inline">\(\gcd(e/k,p-1)=1\)</span>，那么 <span class="math display">\[
\begin{align}
d_p&#39;&amp;=(e/k)^{-1}\pmod{p}\\
m_p^k&amp;\equiv c_p^{d_p&#39;}\pmod{p}
\end{align}
\]</span> 此时相当于变为了加密指数为 <span class="math inline">\(k\)</span> 的 RSA 问题，可以使用 AMM 算法求解
<span class="math inline">\(m_p\)</span>。</p>
<p>那么对于 <span class="math inline">\(n=pq\)</span>，我们首先计算出
<span class="math inline">\(m_p\)</span> 和 <span class="math inline">\(m_q\)</span> 后，对其进行 CRT 即可求出 <span class="math inline">\(m\)</span>。</p>
<blockquote>
<p>需要注意 <span class="math inline">\(ed=1+k\varphi(N)\)</span>，如果说 <span class="math inline">\(g=gcd(e,\varphi(N))\)</span> 恰好为 <span class="math inline">\(k\)</span> 的因子，可以考虑求解 <span class="math inline">\(d=e^{-1}\pmod{\varphi(N)/g}\)</span>，使得其满足
<span class="math inline">\(ed=1+\frac{k}{g}\varphi(N)\)</span>，一样可以求解明文。</p>
</blockquote>
<h3 id="代码-2">代码</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM</span>(<span class="params">delta: <span class="built_in">int</span>, r: <span class="built_in">int</span>, q: <span class="built_in">int</span>, <span class="built_in">all</span>: <span class="built_in">bool</span> = <span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用AMM算法进行有限域开根，即求delta^(1/r)%q下的解</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    `Parameter`:</span></span><br><span class="line"><span class="string">        delta - 底数</span></span><br><span class="line"><span class="string">        r - 根指数</span></span><br><span class="line"><span class="string">        q - 模数</span></span><br><span class="line"><span class="string">        all - 是否返回所有解</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    `Return`:</span></span><br><span class="line"><span class="string">        delta^(1/r)%q下的一个根</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (q - <span class="number">1</span>) % r != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;使用AMM算法需要满足e||(q-1)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># step 1</span></span><br><span class="line">    Fq = GF(q)</span><br><span class="line">    delta = Fq(delta)</span><br><span class="line">    rho = Fq.random_element()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 2</span></span><br><span class="line">    <span class="keyword">while</span> rho ** ((q - <span class="number">1</span>) // r) == <span class="number">1</span>:</span><br><span class="line">        rho = Fq.random_element()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># step 3</span></span><br><span class="line">    <span class="comment"># step 3.1</span></span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    s = q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> s % r == <span class="number">0</span>:</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        s //= r</span><br><span class="line">    <span class="comment"># step 3.2</span></span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (k * s + <span class="number">1</span>) % r != <span class="number">0</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    alpha = (k * s + <span class="number">1</span>) // r</span><br><span class="line">    <span class="comment"># step 3.3</span></span><br><span class="line">    a = rho ** (r ** t - <span class="number">1</span> * s)</span><br><span class="line">    b = delta ** (r * alpha - <span class="number">1</span>)</span><br><span class="line">    c = rho ** s</span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># step 4</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t):</span><br><span class="line">        d = b ** <span class="built_in">pow</span>(r, t - <span class="number">1</span> - i, q - <span class="number">1</span>)</span><br><span class="line">        j = <span class="number">0</span> <span class="keyword">if</span> d == <span class="number">1</span> <span class="keyword">else</span> -d.log(a)</span><br><span class="line">        b *= (c ** r) ** j</span><br><span class="line">        h *= c ** j</span><br><span class="line">        c **= r</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 5</span></span><br><span class="line">    root = <span class="built_in">int</span>(delta ** alpha * h)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>:</span><br><span class="line">        <span class="keyword">return</span> root</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># if all is True, generate all roots to return</span></span><br><span class="line">    <span class="comment"># 2 ^ (q - 1) == 1 (mod q) because of Fermat&#x27;s little theorem</span></span><br><span class="line">    g = <span class="built_in">pow</span>(<span class="number">2</span>, (q - <span class="number">1</span>) // r, q)</span><br><span class="line">    <span class="comment"># find all primitive i-th roots of 1</span></span><br><span class="line">    ith_roots = [<span class="built_in">pow</span>(g, i, q) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r)]</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>(root * ith_root % q) <span class="keyword">for</span> ith_root <span class="keyword">in</span> ith_roots]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">c, e, p</span>):</span><br><span class="line">    k = gcd(e, p - <span class="number">1</span>)</span><br><span class="line">    dp = <span class="built_in">pow</span>(e // k, -<span class="number">1</span>, p - <span class="number">1</span>)</span><br><span class="line">    mp = <span class="built_in">pow</span>(c, dp, p)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">set</span>(AMM(mp, k, p, <span class="literal">True</span>)))</span><br><span class="line"></span><br><span class="line">p = <span class="number">90015842079287188147863599089252975950229149674532065188179308662941668349067</span></span><br><span class="line">q = <span class="number">115639966729427613784046359856154071033236356854800852136894409690977637028073</span></span><br><span class="line">e = <span class="number">458759</span></span><br><span class="line">c = <span class="number">9377489940941407443668888914142468523442868076408679603369421619879641628020535221060883892082291144102991625695716628752564422493350476912185008866541091</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;gcd(e, p - <span class="number">1</span>) = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;gcd(e, q - <span class="number">1</span>) = &#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">mps = decrypt(c, e, p)</span><br><span class="line">mqs = decrypt(c, e, q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;mps = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;mqs = &#125;</span>&#x27;</span>)</span><br><span class="line">ms = []</span><br><span class="line"><span class="keyword">for</span> mp, mq <span class="keyword">in</span> itertools.product(mps, mqs):</span><br><span class="line">    ms.append(CRT([mp, mq], [p, q]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;ms = &#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="pq-高位相同"><span class="math inline">\(p,q\)</span>
高位相同</h2>
<h3 id="特征-7">特征</h3>
<p>已知 <span class="math inline">\(n\)</span>，其中 <span class="math inline">\(|p-q|\)</span> 较小，<span class="math inline">\(p,q\)</span> 数量位知道</p>
<h3 id="实例-1">实例</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nbits = <span class="number">1024</span></span><br><span class="line">p = getPrime(nbits // <span class="number">2</span>)</span><br><span class="line">q = next_prime(p + (<span class="number">1</span> &lt;&lt; <span class="built_in">int</span>(nbits * beta)))</span><br><span class="line">n = p * q</span><br></pre></td></tr></table></figure>
<p>其中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n = 122774778628333786198247673730199699244621671207929503475974934116435291656353398717362903500544713183492877018211738292001516168567879903073296829793548881467270228989482723510323780292947403861546283099122868428902480999485625751961457245487615479377459707992802193391975415447673215862245349068018710525679</span><br><span class="line">beta = 0.44</span><br></pre></td></tr></table></figure>
<p>不妨看作 <span class="math inline">\(n=p\cdot(p+(1 &lt;&lt;
int(nbits*beta)))\)</span>，则可以将 <span class="math inline">\(p\)</span> 的近似值求出来。</p>
<p>这时再进行小范围的爆破即可。（这里需要注意到，近似值与真实值相比是要偏大的，需要使用
<code>previous_prime</code> 函数）</p>
<p>sagemath 脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delta = (<span class="number">1</span> &lt;&lt; <span class="built_in">int</span>(nbits * beta))</span><br><span class="line">R = RealField(<span class="number">1000</span>)</span><br><span class="line">p = polygen(R)</span><br><span class="line">f = p * (p + delta) - n</span><br><span class="line">p = <span class="built_in">int</span>(f.roots()[<span class="number">1</span>][<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> n % p != <span class="number">0</span>:</span><br><span class="line">    p = previous_prime(p)</span><br></pre></td></tr></table></figure>
<p>这样就将 <span class="math inline">\(p\)</span> 爆破出来了。</p>
<h2 id="简单填充攻击">简单填充攻击</h2>
<h3 id="题目描述">题目描述</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x + <span class="string">b&quot;\x00&quot;</span> * (<span class="number">128</span> - <span class="built_in">len</span>(x))</span><br><span class="line"></span><br><span class="line">flag = flag[<span class="number">7</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag) == <span class="number">16</span></span><br><span class="line"></span><br><span class="line">flag = pad(flag)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>, file=f)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>, file=f)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>, file=f)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>n =
20143874513891625472763023083725333814544365923300648765753585512236262936134576226420495156390118451084859695988018681103828733472481714477702312584392200607513775527941225389450524064860609500522646820403150136601325693755011504371254765148925814568051337093873243247759130508598378247848927825303243080348476280520682747234144016534355268883431
e = 65537 c =
9099248209700870107517981697995437593126643973286742880366239649474438147247165218637687381898125380392681666447352387825995403531162271411514111581358141144178855022212666392579294107956774766000410956462804204065293225382573948622209661112442721208408763210528401826636309622296148093801229149917160087959002855064445785159864465696643561701308</p>
</blockquote>
<h3 id="实现-7">实现</h3>
<p>当实际明文<span class="math inline">\(m&lt;p\)</span>时可以恢复</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd, invert</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes, bytes_to_long</span><br><span class="line"></span><br><span class="line"><span class="comment"># 仅在p域下</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">n, e, phi, c</span>):</span><br><span class="line">    d = invert(e, phi)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    p = <span class="number">297342668339361548416629796745639177971</span></span><br><span class="line">    q = <span class="number">67746329937757624632404631102047546126139910162127525807142364896504844830533422758326696949629668349819199912570222748973935637740283799230746144014458722401719184655996325043824137789180083286215748548298177270209171461643103260188864468982281090005047122016817287399362453731379535534001682626445843123261</span></span><br><span class="line"></span><br><span class="line">    n = p * q</span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    e = <span class="number">0x10001</span></span><br><span class="line">    c = <span class="number">9099248209700870107517981697995437593126643973286742880366239649474438147247165218637687381898125380392681666447352387825995403531162271411514111581358141144178855022212666392579294107956774766000410956462804204065293225382573948622209661112442721208408763210528401826636309622296148093801229149917160087959002855064445785159864465696643561701308</span></span><br><span class="line"></span><br><span class="line">    m = dec(n, e, p-<span class="number">1</span>, c)</span><br><span class="line">    t = <span class="number">256</span>**<span class="number">112</span></span><br><span class="line">    t = invert(t, p)</span><br><span class="line">    m = m*t % p</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)).decode())</span><br></pre></td></tr></table></figure>
<h3 id="实现-8">实现</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CRT</span>(<span class="params">r,d</span>):</span><br><span class="line">    M = <span class="number">1</span></span><br><span class="line">    l = <span class="built_in">len</span>(r)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,l):</span><br><span class="line">        M = d[i] * M</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,l):</span><br><span class="line">        md = M//d[i]</span><br><span class="line">        x = (x + gmpy2.invert(md, d[i])  * md *r[i] )%M</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(M+x% M)%M</span><br><span class="line"></span><br><span class="line">p = <span class="number">109935857933867829728985398563235455481120300859311421762540858762721955038310117609456763338082237907005937380873151279351831600225270995344096532750271070807051984097524900957809427861441436796934012393707770012556604479065826879107677002380580866325868240270494148512743861326447181476633546419262340100453</span></span><br><span class="line"></span><br><span class="line">e1 = <span class="number">15218928658178</span></span><br><span class="line">q1=<span class="number">127587319253436643569312142058559706815497211661083866592534217079310497260365307426095661281103710042392775453866174657404985539066741684196020137840472950102380232067786400322600902938984916355631714439668326671310160916766472897536055371474076089779472372913037040153356437528808922911484049460342088834871</span></span><br><span class="line">c1 =  <span class="number">262739975753930281690942784321252339035906196846340713237510382364557685379543498765074448825799342194332681181129770046075018122033421983227887719610112028230603166527303021036386350781414447347150383783816869784006598225583375458609586450854602862569022571672049158809874763812834044257419199631217527367046624888837755311215081173386523806086783266198390289097231168172692326653657393522561741947951887577156666663584249108899327053951891486355179939770150550995812478327735917006194574412518819299303783243886962455399783601229227718787081785391010424030509937403600351414176138124705168002288620664809270046124</span></span><br><span class="line">n1 = p*q1</span><br><span class="line"></span><br><span class="line">e2 = <span class="number">381791429275130</span></span><br><span class="line">q2 =  <span class="number">114401188227479584680884046151299704656920536168767132916589182357583461053336386996123783294932566567773695426689447410311969456458574731187512974868297092638677515283584994416382872450167046416573472658841627690987228528798356894803559278308702635288537653192098514966089168123710854679638671424978221959513</span></span><br><span class="line">c2 =  <span class="number">7395591129228876649030819616685821899204832684995757724924450812977470787822266387122334722132760470911599176362617225218345404468270014548817267727669872896838106451520392806497466576907063295603746660003188440170919490157250829308173310715318925771643105064882620746171266499859049038016902162599261409050907140823352990750298239508355767238575709803167676810456559665476121149766947851911064706646506705397091626648713684511780456955453552020460909638016134124590438425738826828694773960514221910109473941451471431637903182205738738109429736425025621308300895473186381826756650667842656050416299166317372707709596</span></span><br><span class="line">n2 = p*q2</span><br><span class="line"></span><br><span class="line">phi1=(p-<span class="number">1</span>)*(q1-<span class="number">1</span>)</span><br><span class="line">phi2=(p-<span class="number">1</span>)*(q2-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">xx1=gmpy2.gcd(e1,phi1) <span class="comment"># xx1=14</span></span><br><span class="line">xx2=gmpy2.gcd(e2,phi2) <span class="comment"># xx2=14</span></span><br><span class="line"></span><br><span class="line">d1=gmpy2.invert(e1//xx1,phi1)</span><br><span class="line">d2=gmpy2.invert(e2//xx2,phi2)</span><br><span class="line"></span><br><span class="line">nn=[]</span><br><span class="line">aa=[]</span><br><span class="line"></span><br><span class="line">nn.append(q1)</span><br><span class="line">nn.append(q2)</span><br><span class="line">a1=gmpy2.powmod(c1,d1,p*q1)%q1</span><br><span class="line">a2=gmpy2.powmod(c2,d2,p*q2)%q2</span><br><span class="line">aa.append(a1)</span><br><span class="line">aa.append(a2)</span><br><span class="line"></span><br><span class="line">last = CRT(aa,nn)</span><br><span class="line">new_e=<span class="number">7</span></span><br><span class="line">new_phi=(q1-<span class="number">1</span>)*(q2-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">new_d=gmpy2.invert(new_e,new_phi)</span><br><span class="line">m_2=gmpy2.powmod(last,new_d,q1*q2)</span><br><span class="line">m=gmpy2.iroot(m_2,<span class="number">2</span>)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<h2 id="rabin-攻击">Rabin 攻击</h2>
<h3 id="特征-8">特征</h3>
<p><span class="math inline">\(e=2\)</span></p>
<h3 id="原理-12">原理</h3>
<ul>
<li><p>计算出 <span class="math inline">\(m_p\)</span> 和<span class="math inline">\(m_q\)</span>： <span class="math display">\[
\begin{align}
m_p&amp;=\sqrt{c}\mod{p}\newline
m_q&amp;=\sqrt{c}\mod{q}
\end{align}
\]</span></p></li>
<li><p>利用扩展欧几里得算法计算出 <span class="math inline">\(y_p\)</span> 和 <span class="math inline">\(y_q\)</span> <span class="math display">\[
y_p·p+y_q·q=1
\]</span></p></li>
<li><p>然后解得四个明文： <span class="math display">\[
\begin{cases}
a&amp;=&amp;(y_p·p·m_q+y_q·q·m_p)\pmod{n}\\
b&amp;=&amp;n-a\\
c&amp;=&amp;(y_p·p·m_q-y_q·q·m_p)\pmod{n}\\
d&amp;=&amp;n-c
\end{cases}
\]</span></p></li>
<li><p>其中，如果<span class="math inline">\(p,q\)</span>是形为<span class="math inline">\(4k+3\)</span>的不同素数，即<span class="math inline">\(p\equiv q\equiv 3\pmod{4}\)</span>，则 <span class="math display">\[
m_p=c^{\frac{1}{4}(p+1)}\pmod{p}\newline
m_q=c^{\frac{1}{4}(q+1)}\pmod{q}
\]</span></p></li>
</ul>
<h3 id="实现-9">实现</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n=<span class="number">523798549</span></span><br><span class="line">p=<span class="number">10663</span></span><br><span class="line">q=<span class="number">49123</span></span><br><span class="line">e=<span class="number">2</span></span><br><span class="line">c=<span class="number">162853095</span></span><br><span class="line">a,inv_q ,inv_p= gmpy2.gcdext(q,p)</span><br><span class="line">mp = <span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">mq = <span class="built_in">pow</span>(c, (q + <span class="number">1</span>) // <span class="number">4</span>, q)</span><br><span class="line">a = (inv_p * p * mq + inv_q * q * mp) % n</span><br><span class="line">b = n - <span class="built_in">int</span>(a)</span><br><span class="line">c = (inv_p * p * mq - inv_q * q * mp) % n</span><br><span class="line">d = n - <span class="built_in">int</span>(c)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span>(a, b, c, d):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>
<h2 id="最小根求解">最小根求解</h2>
<h3 id="原理-13">原理</h3>
<p>Coppersmith 定理指出在一个 <span class="math inline">\(e\)</span>
阶的 <span class="math inline">\(mod\ n\)</span> 多项式 <span class="math inline">\(f(x)\)</span> 中，如果有一个根小于 <span class="math inline">\(n^\frac{1}{e}\)</span> ，就可以运用一个 O(log n)
的算法求出这些根。</p>
<p>这个定理可以应用于 RSA 算法。如果 <span class="math inline">\(e =
3\)</span>
并且在明文当中只有三分之二的比特是已知的，这种算法可以求出明文中所有的比特。</p>
<h3 id="代码-3">代码</h3>
<p>一般来说我们借助 Sagemath 中的 <code>small_roots</code>
函数替代求解。</p>
<h2 id="pq-存在相同-module-攻击"><span class="math inline">\(p,q\)</span> 存在相同 module 攻击</h2>
<h3 id="特征-9">特征</h3>
<p><span class="math inline">\(p,q\)</span> 的生成需要借助某共同的
module <span class="math inline">\(M\)</span> 进行生成</p>
<h3 id="代码-4">代码</h3>
<p>直接使用他人的脚本，roca 攻击：<a target="_blank" rel="noopener" href="https://github.com/jvdsn/crypto-attacks/blob/c26872bdac2e2d95c5be00e6e593c891c849f446/attacks/factorization/roca.py">https://github.com/jvdsn/crypto-attacks/blob/c26872bdac2e2d95c5be00e6e593c891c849f446/attacks/factorization/roca.py</a></p>
<p>论文《The Return of Coppersmith’s Attack: Practical Factorization of
Widely Used RSA Moduli》指出该攻击方式中 <span class="math inline">\(m,t\)</span> 的选择依据为 <span class="math inline">\(N\)</span> 的位数。</p>
<table>
<thead>
<tr class="header">
<th>nbits</th>
<th><span class="math inline">\(m\)</span></th>
<th><span class="math inline">\(t\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>512</td>
<td>5</td>
<td>6</td>
</tr>
<tr class="even">
<td>1024</td>
<td>4</td>
<td>5</td>
</tr>
<tr class="odd">
<td>2048</td>
<td>6</td>
<td>7</td>
</tr>
<tr class="even">
<td>3072</td>
<td>25</td>
<td>26</td>
</tr>
<tr class="odd">
<td>4096</td>
<td>7</td>
<td>8</td>
</tr>
</tbody>
</table>
<h2 id="有限域开根">有限域开根</h2>
<h3 id="特征-10">特征</h3>
<p><span class="math inline">\(e\)</span> 较小。</p>
<p>或者 <span class="math inline">\(\gcd(e,
\varphi(p))\neq1\)</span>，即 <span class="math inline">\(e\)</span> 与
<span class="math inline">\(\varphi(p)\)</span> 不互素的情况。</p>
<h3 id="原理-14">原理</h3>
<p><span class="math inline">\(e\)</span>
较小时，有限域开方速度较快。</p>
<p>同时运用到了高次剩余的定理：</p>
<p>对于同余式 <span class="math inline">\(X^n\equiv
d\pmod{p}\)</span></p>
<p>当 <span class="math inline">\(n|p-1\)</span> 时，满足 <span class="math display">\[
d^{\frac{p-1}{n}}\equiv 1\pmod{p}
\]</span> 才有解，此时解数为 <span class="math inline">\(n\)</span>；</p>
<p>当 <span class="math inline">\(n\)</span> 无法整除 <span class="math inline">\(p-1\)</span>，满足 <span class="math display">\[
d^{\frac{p-1}{k}}\equiv 1\pmod{p}
\]</span> 其中 <span class="math inline">\(k=\gcd(n,p-1)\)</span>，此时解数为 <span class="math inline">\(k\)</span>。</p>
<p>而我们需要求解的便是 <span class="math inline">\(m^e\equiv
c\pmod{n}\)</span></p>
<p>我们可以在 <span class="math inline">\(p,q\)</span>
域中分别开方得到同余式组（加快求解速度） <span class="math display">\[
\begin{cases}
m_1=\sqrt[e]{c}\pmod{p}\newline
m_2=\sqrt[e]{c}\pmod{q}
\end{cases}
\]</span> 然后利用 CRT 得到 <span class="math display">\[
\begin{cases}
m_1=\sqrt[e]{c}\pmod{p}\newline
m_2=\sqrt[e]{c}\pmod{q}\newline
m=\sqrt[e]{c}\pmod{n}
\end{cases}
\]</span> 但因为有多解，所以需要进行验证。</p>
<h3 id="代码-5">代码</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">p, q, e, c</span>):</span><br><span class="line">    P.&lt;x&gt;=Zmod(p)[]</span><br><span class="line">    f=x^e-c</span><br><span class="line">    mps=f.roots(multiplicities=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    P.&lt;x&gt;=Zmod(p)[]</span><br><span class="line">    g=x^e-c</span><br><span class="line">    mqs=g.roots(multiplicities=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    ms = []</span><br><span class="line">	<span class="keyword">import</span> itertools</span><br><span class="line">    <span class="keyword">for</span> mp, mq <span class="keyword">in</span> itertools.product(mps, mqs):</span><br><span class="line">        m = mp.crt(mq)</span><br><span class="line">        ms.append(m)</span><br><span class="line">    <span class="keyword">return</span> ms</span><br><span class="line"></span><br><span class="line">ms = solve(p, q, e, c)</span><br><span class="line"><span class="built_in">print</span>(ms)</span><br></pre></td></tr></table></figure>
<p>也可以尝试使用 Sagemath 自带的 <code>nth_root()</code> 函数。</p>
<p>线程加速 <code>check</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">something</span>):</span><br><span class="line">    <span class="keyword">if</span> long_to_bytes(<span class="built_in">int</span>(something)).startswith(<span class="string">b&#x27;NCTF&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(something)))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CRT_threading</span>(<span class="params">mps, mqs, p, q</span>):</span><br><span class="line">    <span class="keyword">global</span> flag</span><br><span class="line">    <span class="keyword">for</span> mp, mq <span class="keyword">in</span> itertools.product(mps, mqs):</span><br><span class="line">        m = CRT([mp, mq], [p, q])</span><br><span class="line">        <span class="keyword">if</span> check(m):</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line">            flag = <span class="keyword">not</span> flag</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[-] Done.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">thread_number = <span class="number">32</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(thread_number):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[+] Thread %d starting...&#x27;</span> % i)</span><br><span class="line">    thi = threading.Thread(target=CRT_threading, args=(mps, mqs[i*(<span class="built_in">len</span>(mqs) // thread_number):(i+<span class="number">1</span>)*(<span class="built_in">len</span>(mqs) // thread_number)], p, q), daemon=<span class="literal">True</span>)</span><br><span class="line">    thi.start()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[+] Thread %d starting...&#x27;</span> % (i+<span class="number">1</span>))</span><br><span class="line">thi = threading.Thread(target=CRT_threading, args=(mps, mqs[i*(<span class="built_in">len</span>(mqs) // thread_number):], p, q), daemon=<span class="literal">True</span>)</span><br><span class="line">thi.start()</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> flag:</span><br><span class="line">    ...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="amm">AMM</h3>
<p>在 Sagemath 中，构造多项式求根或者使用 <code>nth_root</code> 的
<code>Johnston</code> 算法（<code>Johnston</code>
算法在针对小指数和不满足 <span class="math inline">\(e||p-1\)</span>
的时候效率较高）对较大指数效率都较为低下，这个时候需要使用
<code>Adleman-Manders-Miller rth Root Extraction Method</code>
算法，简称 <code>AMM</code> 算法快速求有限域下的根。</p>
<p><code>AMM</code>
算法是目前在大指数下求高次根效率也较高的算法，但求高次根时需要满足条件
<span class="math inline">\(e||(p-1)\)</span>，其中 <span class="math inline">\(F_p\)</span> 为有限域。</p>
<blockquote>
<p>目前 Sagemath 的更新进度似乎打算在 Sagemath9.8 加入
<code>nth_root</code> 函数对 <code>AMM</code> 算法的支持。</p>
</blockquote>
<p>算法伪代码如下图所示：</p>
<figure>
<img src="/rsa-note/AMM伪代码.png" alt="AMM伪代码">
<figcaption aria-hidden="true">AMM伪代码</figcaption>
</figure>
<p>Sagemath 代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">AMM</span>(<span class="params">delta: <span class="built_in">int</span>, r: <span class="built_in">int</span>, q: <span class="built_in">int</span>, <span class="built_in">all</span>: <span class="built_in">bool</span> = <span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用AMM算法进行有限域开根，即求delta^(1/r)%q下的解</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    `Parameter`:</span></span><br><span class="line"><span class="string">        delta - 底数</span></span><br><span class="line"><span class="string">        r - 根指数</span></span><br><span class="line"><span class="string">        q - 模数</span></span><br><span class="line"><span class="string">        all - 是否返回所有解</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    `Return`:</span></span><br><span class="line"><span class="string">        delta^(1/r)%q下的一个根</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (q - <span class="number">1</span>) % r != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;使用AMM算法需要满足e||(q-1)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># step 1</span></span><br><span class="line">    Fq = GF(q)</span><br><span class="line">    delta = Fq(delta)</span><br><span class="line">    rho = Fq.random_element()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 2</span></span><br><span class="line">    <span class="keyword">while</span> rho ** ((q - <span class="number">1</span>) // r) == <span class="number">1</span>:</span><br><span class="line">        rho = Fq.random_element()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># step 3</span></span><br><span class="line">    <span class="comment"># step 3.1</span></span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    s = q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> s % r == <span class="number">0</span>:</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        s //= r</span><br><span class="line">    <span class="comment"># step 3.2</span></span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (k * s + <span class="number">1</span>) % r != <span class="number">0</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    alpha = (k * s + <span class="number">1</span>) // r</span><br><span class="line">    <span class="comment"># step 3.3</span></span><br><span class="line">    a = rho ** (r ** t - <span class="number">1</span> * s)</span><br><span class="line">    b = delta ** (r * alpha - <span class="number">1</span>)</span><br><span class="line">    c = rho ** s</span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># step 4</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, t):</span><br><span class="line">        d = b ** <span class="built_in">pow</span>(r, t - <span class="number">1</span> - i, q - <span class="number">1</span>)</span><br><span class="line">        j = <span class="number">0</span> <span class="keyword">if</span> d == <span class="number">1</span> <span class="keyword">else</span> -d.log(a)</span><br><span class="line">        b *= (c ** r) ** j</span><br><span class="line">        h *= c ** j</span><br><span class="line">        c **= r</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 5</span></span><br><span class="line">    root = <span class="built_in">int</span>(delta ** alpha * h)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>:</span><br><span class="line">        <span class="keyword">return</span> root</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># if all is True, generate all roots to return</span></span><br><span class="line">    <span class="comment"># 2 ^ (q - 1) == 1 (mod q) because of Fermat&#x27;s little theorem</span></span><br><span class="line">    g = <span class="built_in">pow</span>(<span class="number">2</span>, (q - <span class="number">1</span>) // r, q)</span><br><span class="line">    <span class="comment"># find all primitive i-th roots of 1</span></span><br><span class="line">    ith_roots = [<span class="built_in">pow</span>(g, i, q) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r)]</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>(root * ith_root % q) <span class="keyword">for</span> ith_root <span class="keyword">in</span> ith_roots]</span><br></pre></td></tr></table></figure>
<h2 id="p-1-光滑数分解"><span class="math inline">\(p-1\)</span>
光滑数分解</h2>
<h3 id="特征-11">特征</h3>
<p><span class="math inline">\(p-1\)</span> 为光滑数。</p>
<h3 id="原理-15">原理</h3>
<p>已知 <span class="math inline">\(p-1\)</span> 为若干个
<code>primes</code> 元素相乘得到的平滑数，其中 <code>primes</code>
为一组已知素数，不妨取 <span class="math display">\[
P=\prod{primes}
\]</span> 那么原素数 <span class="math inline">\(p\)</span> 可以表示为
<span class="math display">\[
p-1=kP
\]</span> 其中 <span class="math inline">\(k\)</span> 为 <span class="math inline">\(primes\)</span> 任意元素的乘积。</p>
<p>费马小定理有，若 <span class="math inline">\(p\)</span>
为一个素数，则对于任意非 <span class="math inline">\(p\)</span> 整数
<span class="math inline">\(a\)</span> 有 <span class="math inline">\(a^{p-1}\equiv1\pmod{p}\)</span> 。</p>
<p>那么取任意的 <span class="math inline">\(a\)</span> ，有 <span class="math display">\[
a^{kP}=1\pmod{p}
\]</span> 即有 <span class="math display">\[
a^P=1\pmod{p}=1+tp,t\in\Z
\]</span> 记 <span class="math inline">\(N=pq\)</span>，那么 <span class="math display">\[
\gcd{(a^P-1,N)}=p
\]</span> 我们便分解了 <span class="math inline">\(N\)</span>。</p>
<p>需要注意的是，实际计算中 <span class="math inline">\(a^P\)</span>
不好计算，一般计算 <span class="math inline">\(a^P-1\pmod
N\)</span>，可以证明与 <span class="math inline">\(1\pmod{p}\)</span>
同余。</p>
<h3 id="实例-2">实例</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime, sieve_base <span class="keyword">as</span> primes</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getPrime</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        n = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> n.bit_length() &lt; bits:</span><br><span class="line">            n *= choice(primes)</span><br><span class="line">        <span class="keyword">if</span> isPrime(n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> n + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag.encode(), <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">p, q = [getPrime(<span class="number">2048</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">n = p * q</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># n = 32849718197337581823002243717057659218502519004386996660885100592872201948834155543125924395614928962750579667346279456710633774501407292473006312537723894221717638059058796679686953564471994009285384798450493756900459225040360430847240975678450171551048783818642467506711424027848778367427338647282428667393241157151675410661015044633282064056800913282016363415202171926089293431012379261585078566301060173689328363696699811123592090204578098276704877408688525618732848817623879899628629300385790344366046641825507767709276622692835393219811283244303899850483748651722336996164724553364097066493953127153066970594638491950199605713033004684970381605908909693802373826516622872100822213645899846325022476318425889580091613323747640467299866189070780620292627043349618839126919699862580579994887507733838561768581933029077488033326056066378869170169389819542928899483936705521710423905128732013121538495096959944889076705471928490092476616709838980562233255542325528398956185421193665359897664110835645928646616337700617883946369110702443135980068553511927115723157704586595844927607636003501038871748639417378062348085980873502535098755568810971926925447913858894180171498580131088992227637341857123607600275137768132347158657063692388249513</span></span><br><span class="line"><span class="comment"># c = 26308018356739853895382240109968894175166731283702927002165268998773708335216338997058314157717147131083296551313334042509806229853341488461087009955203854253313827608275460592785607739091992591431080342664081962030557042784864074533380701014585315663218783130162376176094773010478159362434331787279303302718098735574605469803801873109982473258207444342330633191849040553550708886593340770753064322410889048135425025715982196600650740987076486540674090923181664281515197679745907830107684777248532278645343716263686014941081417914622724906314960249945105011301731247324601620886782967217339340393853616450077105125391982689986178342417223392217085276465471102737594719932347242482670320801063191869471318313514407997326350065187904154229557706351355052446027159972546737213451422978211055778164578782156428466626894026103053360431281644645515155471301826844754338802352846095293421718249819728205538534652212984831283642472071669494851823123552827380737798609829706225744376667082534026874483482483127491533474306552210039386256062116345785870668331513725792053302188276682550672663353937781055621860101624242216671635824311412793495965628876036344731733142759495348248970313655381407241457118743532311394697763283681852908564387282605279108</span></span><br></pre></td></tr></table></figure>
<h3 id="代码-6">代码</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">32849718197337581823002243717057659218502519004386996660885100592872201948834155543125924395614928962750579667346279456710633774501407292473006312537723894221717638059058796679686953564471994009285384798450493756900459225040360430847240975678450171551048783818642467506711424027848778367427338647282428667393241157151675410661015044633282064056800913282016363415202171926089293431012379261585078566301060173689328363696699811123592090204578098276704877408688525618732848817623879899628629300385790344366046641825507767709276622692835393219811283244303899850483748651722336996164724553364097066493953127153066970594638491950199605713033004684970381605908909693802373826516622872100822213645899846325022476318425889580091613323747640467299866189070780620292627043349618839126919699862580579994887507733838561768581933029077488033326056066378869170169389819542928899483936705521710423905128732013121538495096959944889076705471928490092476616709838980562233255542325528398956185421193665359897664110835645928646616337700617883946369110702443135980068553511927115723157704586595844927607636003501038871748639417378062348085980873502535098755568810971926925447913858894180171498580131088992227637341857123607600275137768132347158657063692388249513</span></span><br><span class="line">c = <span class="number">26308018356739853895382240109968894175166731283702927002165268998773708335216338997058314157717147131083296551313334042509806229853341488461087009955203854253313827608275460592785607739091992591431080342664081962030557042784864074533380701014585315663218783130162376176094773010478159362434331787279303302718098735574605469803801873109982473258207444342330633191849040553550708886593340770753064322410889048135425025715982196600650740987076486540674090923181664281515197679745907830107684777248532278645343716263686014941081417914622724906314960249945105011301731247324601620886782967217339340393853616450077105125391982689986178342417223392217085276465471102737594719932347242482670320801063191869471318313514407997326350065187904154229557706351355052446027159972546737213451422978211055778164578782156428466626894026103053360431281644645515155471301826844754338802352846095293421718249819728205538534652212984831283642472071669494851823123552827380737798609829706225744376667082534026874483482483127491533474306552210039386256062116345785870668331513725792053302188276682550672663353937781055621860101624242216671635824311412793495965628876036344731733142759495348248970313655381407241457118743532311394697763283681852908564387282605279108</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">P = prod(primes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里的3是任取的</span></span><br><span class="line">pp = <span class="built_in">pow</span>(<span class="number">3</span>, P, n) - <span class="number">1</span></span><br><span class="line">p = gcd(pp, n)</span><br><span class="line">q = n // <span class="built_in">int</span>(p)</span><br><span class="line"><span class="keyword">assert</span> p * q == n</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br></pre></td></tr></table></figure>
<h3 id="pollard-p-1-method">Pollard p-1 method</h3>
<h4 id="原理-16">原理</h4>
<p>对于 <span class="math inline">\(p-1\)</span>
为光滑数，更有效且通用的方法是使用 <code>Pollard p-1 method</code>
算法。</p>
<p>根据以上的原理证明，Pollard 发现当 <code>primes</code>
恰好为许多小素数的时候，那么 <span class="math inline">\(p-1\)</span>
也整除 <span class="math inline">\(n!\)</span>，其中 <span class="math inline">\(n\)</span> 为不太大的一个整数。</p>
<p>故当我们未知 <span class="math inline">\(primes\)</span>
时，可以简单爆破 <span class="math inline">\(n\)</span> 求解 <span class="math display">\[
g=\gcd(a^{n!}-1,N)
\]</span> 当 <span class="math inline">\(g=1\)</span>
时，需要接着求下一个 <span class="math inline">\(n\)</span> 的值；</p>
<p>当 <span class="math inline">\(g=N\)</span> 时，需要修改 <span class="math inline">\(a\)</span> 的值（实际中一般从 2 开始）；</p>
<p>当 <span class="math inline">\(1&lt;g&lt;N\)</span> 时，那么 <span class="math inline">\(g\)</span> 就是 <span class="math inline">\(N\)</span> 的一个因子。</p>
<p>同理我们实际上会直接求 <span class="math inline">\(a^{n!}-1\pmod{N}\)</span> 而非 <span class="math inline">\(a^{n!}-1\)</span>。</p>
<h4 id="代码-7">代码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line">N = <span class="number">32849718197337581823002243717057659218502519004386996660885100592872201948834155543125924395614928962750579667346279456710633774501407292473006312537723894221717638059058796679686953564471994009285384798450493756900459225040360430847240975678450171551048783818642467506711424027848778367427338647282428667393241157151675410661015044633282064056800913282016363415202171926089293431012379261585078566301060173689328363696699811123592090204578098276704877408688525618732848817623879899628629300385790344366046641825507767709276622692835393219811283244303899850483748651722336996164724553364097066493953127153066970594638491950199605713033004684970381605908909693802373826516622872100822213645899846325022476318425889580091613323747640467299866189070780620292627043349618839126919699862580579994887507733838561768581933029077488033326056066378869170169389819542928899483936705521710423905128732013121538495096959944889076705471928490092476616709838980562233255542325528398956185421193665359897664110835645928646616337700617883946369110702443135980068553511927115723157704586595844927607636003501038871748639417378062348085980873502535098755568810971926925447913858894180171498580131088992227637341857123607600275137768132347158657063692388249513</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PollardMethod</span>(<span class="params">N: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Pollard p-1 method</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    `Parameters`:</span></span><br><span class="line"><span class="string">        N - 要分解的大素数</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    `Returns`:</span></span><br><span class="line"><span class="string">        N的一个因子</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    a = <span class="number">2</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> itertools.count(<span class="number">2</span>):</span><br><span class="line">        a = <span class="built_in">pow</span>(a, n, N)</span><br><span class="line">        g = gcd(a - <span class="number">1</span>, N)</span><br><span class="line">        <span class="keyword">if</span> g == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> g == N:</span><br><span class="line">            a += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(PollardMethod(N))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>需要注意的是，个人使用 Python 没办法跑出结果，得用 Sagemath。</p>
</blockquote>
<p>可以借助 Python 模块 <code>primefac</code> 进行分解：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m primefac -vs -m=p-1 32849718197337581823002243717057659218502519004386996660885100592872201948834155543125924395614928962750579667346279456710633774501407292473006312537723894221717638059058796679686953564471994009285384798450493756900459225040360430847240975678450171551048783818642467506711424027848778367427338647282428667393241157151675410661015044633282064056800913282016363415202171926089293431012379261585078566301060173689328363696699811123592090204578098276704877408688525618732848817623879899628629300385790344366046641825507767709276622692835393219811283244303899850483748651722336996164724553364097066493953127153066970594638491950199605713033004684970381605908909693802373826516622872100822213645899846325022476318425889580091613323747640467299866189070780620292627043349618839126919699862580579994887507733838561768581933029077488033326056066378869170169389819542928899483936705521710423905128732013121538495096959944889076705471928490092476616709838980562233255542325528398956185421193665359897664110835645928646616337700617883946369110702443135980068553511927115723157704586595844927607636003501038871748639417378062348085980873502535098755568810971926925447913858894180171498580131088992227637341857123607600275137768132347158657063692388249513</span><br></pre></td></tr></table></figure>
<h2 id="p-进数攻击"><span class="math inline">\(p\)</span> 进数攻击</h2>
<h3 id="原理-17">原理</h3>
<p>首先我们知道多项式分解的复杂度在于其项数的多少和系数的大小，同时任意一个数我们可以使用多项式来表达，比如说数字
1234567890 可以表达为： <span class="math display">\[
\begin{align}
P_{10}(x)&amp;=x^{9} + 2x^{8} + 3x^{7} + 4x^{6} + 5x^{5} + 6x^{4} +
7x^{3} + 8x^{2} + 9x\\
P(10)&amp;=1234567890
\end{align}
\]</span> 或者是 <span class="math display">\[
\begin{align}
P_{5}(x)&amp;=x^{13} + x^{10} + 2x^{9} + 2x^{7} + 2x^{6} + x^{5} +
3x^{4} + 3x^{3} + 3x\newline
P(5)&amp;=1234567890
\end{align}
\]</span> 甚至是 <span class="math display">\[
\begin{align}
P_{1000}&amp;=x^{3} + 234x^{2} + 567x + 890\newline
P(1000)&amp;=1234567890
\end{align}
\]</span> 可以发现，在不同的 <span class="math inline">\(p\)</span>
进数下，多项式的复杂度会发生改变。</p>
<p>于是乎有可能出现在十进制下多项式复杂，分解时间复杂度高，但在 <span class="math inline">\(p\)</span>
进数下多项式简单，分解时间复杂度低。</p>
<blockquote>
<p><span class="math inline">\(p\)</span>
进数也被用于证明费马大定理。</p>
</blockquote>
<h3 id="实例-3">实例</h3>
<p>分解因数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">264048827496427248021277383801027180195275776366915828865010362454006394906519399441496561006668252031429735502465174250525698696973129422193405161920872162928097673289330345041221985548078586423910246601720647996170161319016119241836415788315729493164331517547663558380515400720081995290120793014108439083514403659082115510258023834737471488528527557960636984676435543300074504679264476413252780514962473070445293528877641502742438571110744667739728450283295649865745629276142949963507003094791773183928894536793857609738113546410753895719242547720815692998871947957214118354127328586542848234994500987288641595105</span></span><br></pre></td></tr></table></figure>
<p>代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">264048827496427248021277383801027180195275776366915828865010362454006394906519399441496561006668252031429735502465174250525698696973129422193405161920872162928097673289330345041221985548078586423910246601720647996170161319016119241836415788315729493164331517547663558380515400720081995290120793014108439083514403659082115510258023834737471488528527557960636984676435543300074504679264476413252780514962473070445293528877641502742438571110744667739728450283295649865745629276142949963507003094791773183928894536793857609738113546410753895719242547720815692998871947957214118354127328586542848234994500987288641595105</span></span><br><span class="line">base = <span class="number">11</span></span><br><span class="line"></span><br><span class="line">P.&lt;x&gt; = ZZ[]</span><br><span class="line">f = P(N.digits(base))</span><br><span class="line"><span class="comment"># (x^295 + 2*x^249 + x^196 + 1) * (x^295 + 2*x^281 + 2*x^192 + x^100 + 2*x^37 + 1)</span></span><br><span class="line">F_factor = factor(f)</span><br><span class="line">factors = []</span><br><span class="line"><span class="keyword">for</span> fac <span class="keyword">in</span> F_factor:</span><br><span class="line">    factors.append(fac[<span class="number">0</span>](base))</span><br><span class="line"><span class="built_in">print</span>(factors)</span><br></pre></td></tr></table></figure>
<h2 id="多项式关联攻击">多项式关联攻击</h2>
<h3 id="原理-18">原理</h3>
<p>如果存在线性相关的明文 <span class="math inline">\(m_1,m_2\)</span>，即存在多项式函数 <span class="math inline">\(f(x)\)</span> 满足 <span class="math display">\[
m_2=f(m_1)
\]</span></p>
<blockquote>
<p>例如一个最简单的多项式函数是 <span class="math inline">\(f(x)=ax+b\)</span>。</p>
</blockquote>
<p>如果说存在一个多项式函数 <span class="math display">\[
g(x)=a_lx^l+a_{l-1}x^{l-1}+\cdots+a_1x+a_0
\]</span> 使得明文满足 <span class="math display">\[
c_1=g(m_1),c_2=g(m_2)=g(f(m_1))
\]</span></p>
<blockquote>
<p>例如一个最常见的首一单项式函数 <span class="math inline">\(c=g(m)=m^e\pmod{N}\)</span>，即 RSA 加密函数。</p>
</blockquote>
<p>那么必然有 <span class="math display">\[
\begin{align}
G(x)&amp;=\gcd(g(m_1)-c_1,g(m_2)-c_2)\newline
&amp;=x-m_1
\end{align}
\]</span> 即 <span class="math display">\[
m_1=-G(0)
\]</span> 在模 <span class="math inline">\(N\)</span> 下也满足。</p>
<p>故在 RSA 中同样可以构建两式破解明文。</p>
<h3 id="代码-8">代码</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">5</span></span><br><span class="line">N = <span class="number">5836720399</span></span><br><span class="line">f = <span class="keyword">lambda</span> x: x + <span class="number">17</span></span><br><span class="line">m1 = <span class="number">781027021</span></span><br><span class="line">m2 = f(m1)</span><br><span class="line">g = <span class="keyword">lambda</span> x: <span class="built_in">pow</span>(x, e, N)</span><br><span class="line">c1 = g(m1)</span><br><span class="line">c2 = g(m2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;e = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;N = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c1 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c2 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">e = 5</span></span><br><span class="line"><span class="string">N = 5836720399</span></span><br><span class="line"><span class="string">c1 = 2083888300</span></span><br><span class="line"><span class="string">c2 = 2918851827</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p>可以写出求解代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">5</span></span><br><span class="line">N = <span class="number">5836720399</span></span><br><span class="line">c1 = <span class="number">2083888300</span></span><br><span class="line">c2 = <span class="number">2918851827</span></span><br><span class="line">f = <span class="keyword">lambda</span> x: x + <span class="number">17</span></span><br><span class="line">m1 = polygen(Zmod(N))</span><br><span class="line">m2 = f(m1)</span><br><span class="line">g = <span class="keyword">lambda</span> x: x ** e</span><br><span class="line">G = gcd(g(m1) - c1, g(m2) - c2)</span><br><span class="line">m1 = <span class="built_in">int</span>(-G(<span class="number">0</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;m1 = &#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>或者可借助于理想求解</p>
<blockquote>
<p>只有 multivariate polynomial rings 的 Ideal 才有
<code>groebner_basis</code> 函数。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">e = <span class="number">5</span></span><br><span class="line">N = <span class="number">5836720399</span></span><br><span class="line">c1 = <span class="number">2083888300</span></span><br><span class="line">c2 = <span class="number">2918851827</span></span><br><span class="line">f = <span class="keyword">lambda</span> x: x + <span class="number">17</span></span><br><span class="line">PR = PolynomialRing(Zmod(N), <span class="string">&#x27;x&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">m1 = PR.gen()</span><br><span class="line">m2 = f(m1)</span><br><span class="line">g = <span class="keyword">lambda</span> x: x ** e</span><br><span class="line">Fs = [g(m1) - c1, g(m2) - c2]</span><br><span class="line">I = Ideal(Fs)</span><br><span class="line">G = I.groebner_basis()[<span class="number">0</span>]</span><br><span class="line">m1 = -G(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;m1 = &#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="扩展-2">扩展</h3>
<p>当我们已知 <span class="math inline">\(l+1\)</span> 个条件 <span class="math display">\[
\begin{align}
f_0(x_1,\cdots,x_l)&amp;=f(x_1,\cdots,x_l)\equiv 0\pmod{N}\newline
f_1(x_1,\cdots,x_l)&amp;=x_1^e-c_1\equiv 0\pmod{N}\newline
f_2(x_1,\cdots,x_l)&amp;=x_2^e-c_2\equiv 0\pmod{N}\newline
&amp;\vdots\newline
f_l(x_1,\cdots,x_l)&amp;=x_l^e-c_l\equiv 0\pmod{N}
\end{align}
\]</span> 我们对其求 Groebner 基有 <span class="math display">\[
[x_1-m_1,\cdots,x_l-m_l]
\]</span> 生成代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;flag&#123;qsdz_1s_yyds_qsdz_1s_yyds&#125;&#x27;</span></span><br><span class="line">flag = pad(flag, <span class="number">48</span>)</span><br><span class="line">m = [<span class="built_in">int</span>.from_bytes(flag[i * <span class="number">16</span>:i * <span class="number">16</span> + <span class="number">16</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">S = <span class="built_in">sum</span>(m) % n</span><br><span class="line">cnt = <span class="built_in">len</span>(m)</span><br><span class="line">A = [random.getrandbits(<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt)]</span><br><span class="line">B = [random.getrandbits(<span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt)]</span><br><span class="line">C = [random.getrandbits(<span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt)]</span><br><span class="line">Cs = [<span class="built_in">int</span>(<span class="built_in">pow</span>((A[i] * m[i]**<span class="number">2</span> + B[i] * m[i] + C[i]), e, n)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;S = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;A = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;B = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;C = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;e = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;n = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;Cs = &#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>使用理想求解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">S = <span class="number">312186279122728322840451063402809132934</span></span><br><span class="line">A = [<span class="number">59306</span>, <span class="number">30233</span>, <span class="number">16498</span>]</span><br><span class="line">B = [<span class="number">3518064068</span>, <span class="number">1743840779</span>, <span class="number">968272001</span>]</span><br><span class="line">C = [<span class="number">3937571722</span>, <span class="number">2632887300</span>, <span class="number">4010585432</span>]</span><br><span class="line">e = <span class="number">5</span></span><br><span class="line">n = <span class="number">18066984073475342789493692613823811785487239998753985805020579267940896948081977001771518523566472410672469410750970677917794989108185341025224936232967134929583548467862041251918442321275217404983105419368662343665374632165656617420205237026045440172381460935460690939381735444035707066029853110776298630061438907984659853208747287992151782531561151400196784932859377900035524366656621630353334553560825733409533365949100590660823734584006536175326697501394564510286279450317686958337988217355014539606930767250922535983519405417158647496890748820686624906060567276540610448840500483189314710494353563879277794541353</span></span><br><span class="line">Cs = [<span class="number">1605011707284276632103824644590203887016797212847098299446289280674897645002161069677543064343533796490420264529467459463526241913229967023798085318628445950097108809898826295428523862026843521177725032160711865551726777679038376141316425909360840477060120073221091013634795786803742332494305103072574470667738491664498087291656588818784515569714358898421758142569763447554120962624497276016496694140100000</span>, <span class="number">181734039700238704012658418593813266912521651894752866626415626828623947405568804251736115950606071068346648144215703817981273278046087507889172667757867256797631566535849534415227715943523579302779674337105968419763028025748461306053447376558392979833811008114700852873079622034093487878691189882417957256088379073866088138200910652985291201335834644957095984704369396287502740148745261121583050802561024</span>, <span class="number">44120289726668300688172841856869479594776389466065225989061060426577417071904451062768078357173832546168316502143084515709199818093521749001394049673866578656496253883891021254583201653096210245674629552133246459157519698072200401130427631509011414976317349970710420293614611921718541830198891304752451947110143182603538593757393837717582250960575842815038472270815811197204422601423145762307051</span>]</span><br><span class="line">cnt = <span class="built_in">len</span>(Cs)</span><br><span class="line"></span><br><span class="line">PR = PolynomialRing(Zmod(n), <span class="string">&#x27;m&#x27;</span>, cnt)</span><br><span class="line">m = PR.gens()  <span class="comment"># 生成 cnt 个 m，用下标区分符号</span></span><br><span class="line">Fs = [((A[i] * m[i]**<span class="number">2</span> + B[i] * m[i] + C[i])**e - Cs[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt)]</span><br><span class="line"><span class="comment"># 这里的额外条件可变</span></span><br><span class="line">Fs.append(<span class="built_in">sum</span>(m) - S)</span><br><span class="line">I = Ideal(Fs)</span><br><span class="line">G_b = I.groebner_basis()</span><br><span class="line"><span class="keyword">for</span> b <span class="keyword">in</span> G_b:</span><br><span class="line">    mi = ZZ(-b(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))  <span class="comment"># 3 个元</span></span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(mi)))</span><br></pre></td></tr></table></figure>
<h2 id="随机填充多项式">随机填充多项式</h2>
<h3 id="原理-19">原理</h3>
<p>与多项式关联攻击不同的是，在这里我们已知 <span class="math inline">\(c_1,c_2\)</span>，且已知关系 <span class="math display">\[
m_2=m_1+b
\]</span> 但我们需要求解的是 <span class="math inline">\(b\)</span>。</p>
<p>考虑 <span class="math display">\[
\begin{align}
m_1^3-c_1&amp;\equiv 0\pmod{N}\newline
(m_1+b)^3-c_2&amp;\equiv 0\pmod{N}
\end{align}
\]</span> 由于两式都存在公共根 <span class="math inline">\(m_1\)</span>，那么其对 <span class="math inline">\(m_1\)</span> 的结式有非零零点，即线性方程 <span class="math inline">\(\varphi(P,Q)=0\)</span> 有非零解。</p>
<p>显然两式的结式是关于 <span class="math inline">\(b\)</span>
的函数，那么我们可以使用 Coppersmith 方法求解 <span class="math inline">\(b\)</span>，需要满足 <span class="math inline">\(b&lt;N^{1/9}\)</span>。</p>
<h3 id="代码-9">代码</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">128</span>)</span><br><span class="line">q = getPrime(<span class="number">128</span>)</span><br><span class="line">N = p * q</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">m1 = <span class="number">12345678909876543211234567890987654321</span></span><br><span class="line"><span class="keyword">assert</span> m1 &lt; N</span><br><span class="line">b = random.getrandbits(<span class="number">16</span>)</span><br><span class="line">m2 = m1 + b</span><br><span class="line">c1 = <span class="built_in">pow</span>(m1, e, N)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m2, e, N)</span><br><span class="line"><span class="comment"># print(f&#x27;&#123;p = &#125;&#x27;)</span></span><br><span class="line"><span class="comment"># print(f&#x27;&#123;q = &#125;&#x27;)</span></span><br><span class="line"><span class="comment"># print(f&#x27;&#123;e = &#125;&#x27;)</span></span><br><span class="line"><span class="comment"># print(f&#x27;&#123;b = &#125;&#x27;)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;N = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c1 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c2 = &#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>获得 <span class="math inline">\(N,c_1,c_2\)</span>
即可求解，但需要知道 <span class="math inline">\(b\)</span> 的范围</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">56436527799596600766941861586070268729876941786810367535069648964447679452103</span></span><br><span class="line">c1 = <span class="number">12073228961013942273133217560992243967967964540450220284564024509779603201167</span></span><br><span class="line">c2 = <span class="number">27368061585067693852702568126262342364990409791917711366691159936158442852034</span></span><br><span class="line"></span><br><span class="line">PR.&lt;m1, b&gt; = ZZ[]</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">f1 = m1 ** e - c1</span><br><span class="line">f2 = (m1 + b) ** e - c2</span><br><span class="line">R = f1.resultant(f2, m1)</span><br><span class="line">P.&lt;x&gt; = Zmod(N)[]</span><br><span class="line">F = R(<span class="number">0</span>, x)</span><br><span class="line">F.small_roots(<span class="number">2</span>**<span class="number">16</span>, beta=<span class="number">1.</span>/<span class="number">9</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>目前只研究了 <span class="math inline">\(e=3\)</span> 的情况。</p>
</blockquote>
<h2 id="已知-poplus-q">已知 <span class="math inline">\(p\oplus
q\)</span></h2>
<h3 id="原理-20">原理</h3>
<p>已知 <span class="math inline">\(x=p\oplus q\)</span>
的结果，就相当于一个 GF(2) 下的多项式的加法结果已知，同时又因为 <span class="math inline">\(n=pq\)</span>，故其多项式的乘法结果也已知，此时我们仅需简单爆破系数或直接构造矩阵求解即可。</p>
<p>参考代码：<a target="_blank" rel="noopener" href="https://github.com/sliedes/xor_factor">https://github.com/sliedes/xor_factor</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>qsdz
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://hasegawaazusa.github.io/rsa-note.html" title="RSA 笔记">https://hasegawaazusa.github.io/rsa-note.html</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/crypto/" rel="tag"><i class="fa fa-tag"></i> crypto</a>
              <a href="/tags/note/" rel="tag"><i class="fa fa-tag"></i> note</a>
              <a href="/tags/rsa/" rel="tag"><i class="fa fa-tag"></i> rsa</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/mersenne-twister-note.html" rel="prev" title="Mersenne Twister 梅森旋转算法笔记">
                  <i class="fa fa-chevron-left"></i> Mersenne Twister 梅森旋转算法笔记
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/latex-math-note.html" rel="next" title="latex 数学公式笔记">
                  latex 数学公式笔记 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2022 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">863k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">13:04</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
